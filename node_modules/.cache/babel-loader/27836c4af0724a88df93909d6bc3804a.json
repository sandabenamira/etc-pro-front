{"ast":null,"code":"var _jsxFileName = \"/home/oem/Documents/projects/educap/classebook-front-web/src/app/routes/Assiduity/routes/Timetable/index.js\";\nimport React from 'react';\nimport 'react-big-calendar/lib/addons/dragAndDrop/styles.css';\nimport { connect } from \"react-redux\";\nimport TimeTable from './TimeTable';\nimport { roleIdStudent, roleIdParent, roleIdAdmin, roleIdProfessor } from '../../../../../config/config';\nimport { getEventsByEstabAndSchoolYear, getEventsByEstabAndSchoolYearForProf } from \"../../../../../actions/planningActions\";\nimport _ from 'lodash';\nimport moment from 'moment';\nimport IntlMessages from '../../../../../util/IntlMessages';\n\nclass ALMANACH extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleChangeClasse = name => event => {\n      this.props.dispatch(getEventsByEstabAndSchoolYear(this.props.userProfile.establishment_id, this.props.userProfile.school_year_id, event.target.value));\n      this.setState({\n        classId: event.target.value\n      });\n    };\n\n    this.handleChange = name => event => {\n      let establishmentClasse = this.props.classes.filter(classe => classe.establishment_id === event.target.value);\n      this.setState({\n        [name]: event.target.value,\n        establishmentClass: establishmentClasse,\n        events: [],\n        classe: ''\n      });\n    };\n\n    this.state = {\n      establishment: '',\n      establishmentClass: [],\n      classId: null,\n      supplieModal: false,\n      eventId: '',\n      establishmentRooms: []\n    };\n    this.handleChangeClasse = this.handleChangeClasse.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n    this.event = this.event.bind(this);\n  }\n\n  event({\n    event\n  }) {\n    console.log(event);\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: 'Popover-' + event.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 33,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      style: {\n        alignItems: 'center',\n        margin: 'auto',\n        fontFamily: 'Raleway',\n        fontSize: \"16px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 34,\n        columnNumber: 7\n      }\n    }, event.eventType === \"lesson\" && this.props.userProfile.role_id === roleIdProfessor ? /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 35,\n        columnNumber: 91\n      }\n    }, /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 35,\n        columnNumber: 94\n      }\n    }, event.subjectName), \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 35,\n        columnNumber: 121\n      }\n    }), event.classeName, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 35,\n        columnNumber: 146\n      }\n    }), event.roomName) : event.eventType === \"lesson\" && this.props.userProfile.role_id !== roleIdProfessor ? /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 36,\n        columnNumber: 97\n      }\n    }, /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 36,\n        columnNumber: 100\n      }\n    }, event.subjectName), \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 36,\n        columnNumber: 127\n      }\n    }), event.roomName, /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 36,\n        columnNumber: 149\n      }\n    }), moment(event.start).format(\"HH:mm\"), \" - \", moment(event.end).format(\"HH:mm\")) : event.eventType === \"exam\" && this.props.userProfile.role_id === roleIdProfessor ? /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 37,\n        columnNumber: 95\n      }\n    }, \" \", /*#__PURE__*/React.createElement(IntlMessages, {\n      id: \"components.note.exam\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 37,\n        columnNumber: 99\n      }\n    }), \": \", /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 37,\n        columnNumber: 143\n      }\n    }, event.subjectName), \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 37,\n        columnNumber: 170\n      }\n    }), event.classeName, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 37,\n        columnNumber: 195\n      }\n    }), event.roomName, \" \") : event.eventType === \"exam\" && this.props.userProfile.role_id !== roleIdProfessor ? /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 38,\n        columnNumber: 95\n      }\n    }, \" \", /*#__PURE__*/React.createElement(IntlMessages, {\n      id: \"components.note.exam\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 38,\n        columnNumber: 99\n      }\n    }), \": \", /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 38,\n        columnNumber: 143\n      }\n    }, event.subjectName), \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 38,\n        columnNumber: 170\n      }\n    }), event.roomName, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 38,\n        columnNumber: 193\n      }\n    }), moment(event.start).format(\"HH:mm\"), \" - \", moment(event.end).format(\"HH:mm\")) : event.eventType === \"holidays\" ? /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 39,\n        columnNumber: 45\n      }\n    }, \" \", /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 39,\n        columnNumber: 49\n      }\n    }, event.title)) : event.eventType === \"schoolVacation\" ? /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 40,\n        columnNumber: 58\n      }\n    }, /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 40,\n        columnNumber: 61\n      }\n    }, event.title), \" \") : event.eventType === \"event\" && this.props.userProfile.role_id === roleIdProfessor ? /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 41,\n        columnNumber: 104\n      }\n    }, /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 41,\n        columnNumber: 107\n      }\n    }, event.title), \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 41,\n        columnNumber: 128\n      }\n    }), event.classeName, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 41,\n        columnNumber: 153\n      }\n    }), event.roomName) : event.eventType === \"event\" && this.props.userProfile.role_id !== roleIdProfessor ? /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 42,\n        columnNumber: 106\n      }\n    }, /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 42,\n        columnNumber: 109\n      }\n    }, event.title), \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 42,\n        columnNumber: 130\n      }\n    }), event.roomName, \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 42,\n        columnNumber: 153\n      }\n    }), moment(event.start).format(\"HH:mm\"), \" - \", moment(event.end).format(\"HH:mm\")) : \"\"));\n  }\n\n  UNSAFE_componentWillMount() {\n    let inscriptionsData = [];\n\n    if (this.props.userProfile.role_id === roleIdStudent) {\n      inscriptionsData = this.props.userProfile.user.profiles[0].students[0].inscription;\n      let currentInscription = inscriptionsData.filter(element => element.fk_id_school_year === this.props.userProfile.school_year_id);\n\n      if (!_.isEmpty(currentInscription)) {\n        const classId = currentInscription[0].fk_id_class_v4;\n        this.props.dispatch(getEventsByEstabAndSchoolYear(this.props.userProfile.establishment_id, this.props.userProfile.school_year_id, classId));\n      }\n    } else if (this.props.userProfile.role_id === roleIdParent) {\n      //case: parent have one student\n      inscriptionsData = this.props.userProfile.user.profiles[0].parents[0].student_parents[0].student.inscription;\n      let currentInscription = inscriptionsData.filter(element => element.fk_id_school_year === this.props.userProfile.school_year_id);\n\n      if (!_.isEmpty(currentInscription)) {\n        const classId = currentInscription[0].fk_id_class_v4;\n        this.props.dispatch(getEventsByEstabAndSchoolYear(this.props.userProfile.establishment_id, this.props.userProfile.school_year_id, classId));\n      }\n    } else if (this.props.userProfile.role_id === roleIdAdmin) {\n      this.setState({\n        establishmentClass: this.props.classes\n      });\n    } else if (this.props.userProfile.role_id === roleIdProfessor) {\n      this.props.dispatch(getEventsByEstabAndSchoolYearForProf(this.props.userProfile.establishment_id, this.props.userProfile.school_year_id, this.props.userProfile.id));\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.userProfile.role_id === roleIdAdmin && prevProps.classes !== this.props.classes) {\n      this.setState({\n        establishmentClass: this.props.classes\n      });\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"app-wrapper\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(TimeTable, {\n      match: this.props.match,\n      establishments: this.props.establishments,\n      handleChange: this.handleChange,\n      establishment: this.state.establishment,\n      events: this.props.events,\n      handleChangeClasse: this.handleChangeClasse,\n      establishmentClass: this.state.establishmentClass,\n      startTime: this.props.startTime,\n      endTime: this.props.endTime,\n      classId: this.state.classId,\n      event: this.event,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 9\n      }\n    }));\n  }\n\n}\n\n;\n\nconst mapStateToProps = state => {\n  return {\n    establishments: state.establishment.remoteEstablishments,\n    userProfile: state.auth.userProfile,\n    events: state.planning.events,\n    startTime: state.settings.startTime,\n    endTime: state.settings.endTime,\n    classes: state.ClassSettingsReducer.classSettings\n  };\n};\n\nexport default connect(mapStateToProps)(ALMANACH);","map":{"version":3,"sources":["/home/oem/Documents/projects/educap/classebook-front-web/src/app/routes/Assiduity/routes/Timetable/index.js"],"names":["React","connect","TimeTable","roleIdStudent","roleIdParent","roleIdAdmin","roleIdProfessor","getEventsByEstabAndSchoolYear","getEventsByEstabAndSchoolYearForProf","_","moment","IntlMessages","ALMANACH","Component","constructor","props","handleChangeClasse","name","event","dispatch","userProfile","establishment_id","school_year_id","target","value","setState","classId","handleChange","establishmentClasse","classes","filter","classe","establishmentClass","events","state","establishment","supplieModal","eventId","establishmentRooms","bind","console","log","id","alignItems","margin","fontFamily","fontSize","eventType","role_id","subjectName","classeName","roomName","start","format","end","title","UNSAFE_componentWillMount","inscriptionsData","user","profiles","students","inscription","currentInscription","element","fk_id_school_year","isEmpty","fk_id_class_v4","parents","student_parents","student","componentDidUpdate","prevProps","render","match","establishments","startTime","endTime","mapStateToProps","remoteEstablishments","auth","planning","settings","ClassSettingsReducer","classSettings"],"mappings":";AACA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAO,sDAAP;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,OAAOC,SAAP,MAAsB,aAAtB;AACA,SAASC,aAAT,EAAwBC,YAAxB,EAAsCC,WAAtC,EAAmDC,eAAnD,QAA0E,8BAA1E;AACA,SAASC,6BAAT,EAAwCC,oCAAxC,QAAoF,wCAApF;AACA,OAAOC,CAAP,MAAc,QAAd;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,YAAP,MAAyB,kCAAzB;;AAGA,MAAMC,QAAN,SAAuBZ,KAAK,CAACa,SAA7B,CAAuC;AACrCC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;;AADiB,SAoCnBC,kBApCmB,GAoCEC,IAAI,IAAIC,KAAK,IAAI;AACpC,WAAKH,KAAL,CAAWI,QAAX,CACEZ,6BAA6B,CAC3B,KAAKQ,KAAL,CAAWK,WAAX,CAAuBC,gBADI,EAE3B,KAAKN,KAAL,CAAWK,WAAX,CAAuBE,cAFI,EAG3BJ,KAAK,CAACK,MAAN,CAAaC,KAHc,CAD/B;AAMA,WAAKC,QAAL,CAAc;AAAEC,QAAAA,OAAO,EAAER,KAAK,CAACK,MAAN,CAAaC;AAAxB,OAAd;AACD,KA5CkB;;AAAA,SA6CnBG,YA7CmB,GA6CJV,IAAI,IAAIC,KAAK,IAAI;AAE9B,UAAIU,mBAAmB,GAAG,KAAKb,KAAL,CAAWc,OAAX,CAAmBC,MAAnB,CAA0BC,MAAM,IAAIA,MAAM,CAACV,gBAAP,KAA4BH,KAAK,CAACK,MAAN,CAAaC,KAA7E,CAA1B;AACA,WAAKC,QAAL,CAAc;AAAE,SAACR,IAAD,GAAQC,KAAK,CAACK,MAAN,CAAaC,KAAvB;AAA8BQ,QAAAA,kBAAkB,EAAEJ,mBAAlD;AAAuEK,QAAAA,MAAM,EAAE,EAA/E;AAAmFF,QAAAA,MAAM,EAAE;AAA3F,OAAd;AACD,KAjDkB;;AAEjB,SAAKG,KAAL,GAAa;AACXC,MAAAA,aAAa,EAAE,EADJ;AAEXH,MAAAA,kBAAkB,EAAE,EAFT;AAGXN,MAAAA,OAAO,EAAE,IAHE;AAIXU,MAAAA,YAAY,EAAE,KAJH;AAKXC,MAAAA,OAAO,EAAE,EALE;AAMXC,MAAAA,kBAAkB,EAAE;AANT,KAAb;AAQA,SAAKtB,kBAAL,GAA0B,KAAKA,kBAAL,CAAwBuB,IAAxB,CAA6B,IAA7B,CAA1B;AACA,SAAKZ,YAAL,GAAoB,KAAKA,YAAL,CAAkBY,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAKrB,KAAL,GAAa,KAAKA,KAAL,CAAWqB,IAAX,CAAgB,IAAhB,CAAb;AACD;;AAEDrB,EAAAA,KAAK,CAAC;AAAEA,IAAAA;AAAF,GAAD,EAAY;AAClBsB,IAAAA,OAAO,CAACC,GAAR,CAAYvB,KAAZ;AAEG,wBACE;AAAK,MAAA,EAAE,EAAE,aAAWA,KAAK,CAACwB,EAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACA;AAAM,MAAA,KAAK,EAAE;AAAEC,QAAAA,UAAU,EAAE,QAAd;AAAwBC,QAAAA,MAAM,EAAE,MAAhC;AAAwCC,QAAAA,UAAU,EAAE,SAApD;AAA8DC,QAAAA,QAAQ,EAAC;AAAvE,OAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACD5B,KAAK,CAAC6B,SAAN,KAAoB,QAApB,IAAgC,KAAKhC,KAAL,CAAWK,WAAX,CAAuB4B,OAAvB,KAAmC1C,eAAnE,gBAAqF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAIY,KAAK,CAAC+B,WAAV,CAAH,oBAA8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAA9B,EAAqC/B,KAAK,CAACgC,UAA3C,oBAAuD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAvD,EAA8DhC,KAAK,CAACiC,QAApE,CAArF,GACMjC,KAAK,CAAC6B,SAAN,KAAoB,QAApB,IAAgC,KAAKhC,KAAL,CAAWK,WAAX,CAAuB4B,OAAvB,KAAmC1C,eAAnE,gBAAqF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAIY,KAAK,CAAC+B,WAAV,CAAH,oBAA8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAA9B,EAAqC/B,KAAK,CAACiC,QAA3C,eAAoD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAApD,EAA0DzC,MAAM,CAACQ,KAAK,CAACkC,KAAP,CAAN,CAAoBC,MAApB,CAA2B,OAA3B,CAA1D,SAAkG3C,MAAM,CAACQ,KAAK,CAACoC,GAAP,CAAN,CAAkBD,MAAlB,CAAyB,OAAzB,CAAlG,CAArF,GACAnC,KAAK,CAAC6B,SAAN,KAAoB,MAApB,IAA8B,KAAKhC,KAAL,CAAWK,WAAX,CAAuB4B,OAAvB,KAAmC1C,eAAjE,gBAAmF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAAI,oBAAC,YAAD;AAAc,MAAA,EAAE,EAAC,sBAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAJ,qBAAgD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAIY,KAAK,CAAC+B,WAAV,CAAhD,oBAA2E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAA3E,EAAkF/B,KAAK,CAACgC,UAAxF,oBAAoG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAApG,EAA2GhC,KAAK,CAACiC,QAAjH,MAAnF,GACAjC,KAAK,CAAC6B,SAAN,KAAoB,MAApB,IAA+B,KAAKhC,KAAL,CAAWK,WAAX,CAAuB4B,OAAvB,KAAmC1C,eAAlE,gBAAmF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAAI,oBAAC,YAAD;AAAc,MAAA,EAAE,EAAC,sBAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAJ,qBAAgD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAIY,KAAK,CAAC+B,WAAV,CAAhD,oBAA2E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAA3E,EAAkF/B,KAAK,CAACiC,QAAxF,oBAAkG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAlG,EAAyGzC,MAAM,CAACQ,KAAK,CAACkC,KAAP,CAAN,CAAoBC,MAApB,CAA2B,OAA3B,CAAzG,SAAiJ3C,MAAM,CAACQ,KAAK,CAACoC,GAAP,CAAN,CAAkBD,MAAlB,CAAyB,OAAzB,CAAjJ,CAAnF,GACAnC,KAAK,CAAC6B,SAAN,KAAoB,UAApB,gBAAiC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAI7B,KAAK,CAACqC,KAAV,CAAJ,CAAjC,GACOrC,KAAK,CAAC6B,SAAN,KAAoB,gBAApB,gBAAuC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAI7B,KAAK,CAACqC,KAAV,CAAH,MAAvC,GACArC,KAAK,CAAC6B,SAAN,KAAoB,OAApB,IAA+B,KAAKhC,KAAL,CAAWK,WAAX,CAAuB4B,OAAvB,KAAmC1C,eAAlE,gBAAqF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAIY,KAAK,CAACqC,KAAV,CAAH,oBAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAxB,EAA+BrC,KAAK,CAACgC,UAArC,oBAAiD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAjD,EAAwDhC,KAAK,CAACiC,QAA9D,CAArF,GACEjC,KAAK,CAAC6B,SAAN,KAAoB,OAApB,IAA+B,KAAKhC,KAAL,CAAWK,WAAX,CAAuB4B,OAAvB,KAAmC1C,eAAlE,gBAAqF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAIY,KAAK,CAACqC,KAAV,CAAH,oBAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAxB,EAA+BrC,KAAK,CAACiC,QAArC,oBAA+C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAA/C,EAAsDzC,MAAM,CAACQ,KAAK,CAACkC,KAAP,CAAN,CAAoBC,MAApB,CAA2B,OAA3B,CAAtD,SAA8F3C,MAAM,CAACQ,KAAK,CAACoC,GAAP,CAAN,CAAkBD,MAAlB,CAAyB,OAAzB,CAA9F,CAArF,GACD,EATb,CADA,CADF;AAiBD;;AAeDG,EAAAA,yBAAyB,GAAG;AAE1B,QAAIC,gBAAgB,GAAG,EAAvB;;AACA,QAAI,KAAK1C,KAAL,CAAWK,WAAX,CAAuB4B,OAAvB,KAAmC7C,aAAvC,EAAsD;AACpDsD,MAAAA,gBAAgB,GAAG,KAAK1C,KAAL,CAAWK,WAAX,CAAuBsC,IAAvB,CAA4BC,QAA5B,CAAqC,CAArC,EAAwCC,QAAxC,CAAiD,CAAjD,EAAoDC,WAAvE;AACA,UAAIC,kBAAkB,GAAGL,gBAAgB,CAAC3B,MAAjB,CAAwBiC,OAAO,IAAIA,OAAO,CAACC,iBAAR,KAA8B,KAAKjD,KAAL,CAAWK,WAAX,CAAuBE,cAAxF,CAAzB;;AACF,UAAI,CAACb,CAAC,CAACwD,OAAF,CAAUH,kBAAV,CAAL,EAAoC;AAClC,cAAMpC,OAAO,GAAGoC,kBAAkB,CAAC,CAAD,CAAlB,CAAsBI,cAAtC;AACA,aAAKnD,KAAL,CAAWI,QAAX,CAAoBZ,6BAA6B,CAAC,KAAKQ,KAAL,CAAWK,WAAX,CAAuBC,gBAAxB,EAAyC,KAAKN,KAAL,CAAWK,WAAX,CAAuBE,cAAhE,EAA+EI,OAA/E,CAAjD;AACD;AACA,KAPD,MAOO,IAAI,KAAKX,KAAL,CAAWK,WAAX,CAAuB4B,OAAvB,KAAmC5C,YAAvC,EAAqD;AAC1D;AACAqD,MAAAA,gBAAgB,GAAG,KAAK1C,KAAL,CAAWK,WAAX,CAAuBsC,IAAvB,CAA4BC,QAA5B,CAAqC,CAArC,EAAwCQ,OAAxC,CAAgD,CAAhD,EAAmDC,eAAnD,CAAmE,CAAnE,EAAsEC,OAAtE,CAA8ER,WAAjG;AACA,UAAIC,kBAAkB,GAAGL,gBAAgB,CAAC3B,MAAjB,CAAwBiC,OAAO,IAAIA,OAAO,CAACC,iBAAR,KAA8B,KAAKjD,KAAL,CAAWK,WAAX,CAAuBE,cAAxF,CAAzB;;AACA,UAAI,CAACb,CAAC,CAACwD,OAAF,CAAUH,kBAAV,CAAL,EAAoC;AAClC,cAAMpC,OAAO,GAAGoC,kBAAkB,CAAC,CAAD,CAAlB,CAAsBI,cAAtC;AACA,aAAKnD,KAAL,CAAWI,QAAX,CAAoBZ,6BAA6B,CAAC,KAAKQ,KAAL,CAAWK,WAAX,CAAuBC,gBAAxB,EAAyC,KAAKN,KAAL,CAAWK,WAAX,CAAuBE,cAAhE,EAA+EI,OAA/E,CAAjD;AACD;AAEF,KATM,MASD,IAAI,KAAKX,KAAL,CAAWK,WAAX,CAAuB4B,OAAvB,KAAmC3C,WAAvC,EAAmD;AACvD,WAAKoB,QAAL,CAAc;AAACO,QAAAA,kBAAkB,EAAE,KAAKjB,KAAL,CAAWc;AAAhC,OAAd;AAED,KAHK,MAGA,IAAI,KAAKd,KAAL,CAAWK,WAAX,CAAuB4B,OAAvB,KAAmC1C,eAAvC,EAAuD;AAC3D,WAAKS,KAAL,CAAWI,QAAX,CAAoBX,oCAAoC,CAAC,KAAKO,KAAL,CAAWK,WAAX,CAAuBC,gBAAxB,EAAyC,KAAKN,KAAL,CAAWK,WAAX,CAAuBE,cAAhE,EAA+E,KAAKP,KAAL,CAAWK,WAAX,CAAuBsB,EAAtG,CAAxD;AACD;AACF;;AACD4B,EAAAA,kBAAkB,CAACC,SAAD,EAAY;AAC5B,QAAI,KAAKxD,KAAL,CAAWK,WAAX,CAAuB4B,OAAvB,KAAmC3C,WAAnC,IAAkDkE,SAAS,CAAC1C,OAAV,KAAsB,KAAKd,KAAL,CAAWc,OAAvF,EAAgG;AAC9F,WAAKJ,QAAL,CAAc;AAACO,QAAAA,kBAAkB,EAAE,KAAKjB,KAAL,CAAWc;AAAhC,OAAd;AACD;AACF;;AACD2C,EAAAA,MAAM,GAAG;AACP,wBAEE;AAAK,MAAA,SAAS,EAAC,aAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,SAAD;AACE,MAAA,KAAK,EAAE,KAAKzD,KAAL,CAAW0D,KADpB;AAEE,MAAA,cAAc,EAAE,KAAK1D,KAAL,CAAW2D,cAF7B;AAGE,MAAA,YAAY,EAAE,KAAK/C,YAHrB;AAIE,MAAA,aAAa,EAAE,KAAKO,KAAL,CAAWC,aAJ5B;AAKE,MAAA,MAAM,EAAE,KAAKpB,KAAL,CAAWkB,MALrB;AAME,MAAA,kBAAkB,EAAE,KAAKjB,kBAN3B;AAOE,MAAA,kBAAkB,EAAE,KAAKkB,KAAL,CAAWF,kBAPjC;AAQE,MAAA,SAAS,EAAE,KAAKjB,KAAL,CAAW4D,SARxB;AASE,MAAA,OAAO,EAAE,KAAK5D,KAAL,CAAW6D,OATtB;AAUE,MAAA,OAAO,EAAE,KAAK1C,KAAL,CAAWR,OAVtB;AAWE,MAAA,KAAK,EAAE,KAAKR,KAXd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CAFF;AAkBD;;AArGoC;;AAsGtC;;AACD,MAAM2D,eAAe,GAAI3C,KAAD,IAAW;AACjC,SAAO;AACLwC,IAAAA,cAAc,EAAExC,KAAK,CAACC,aAAN,CAAoB2C,oBAD/B;AAEL1D,IAAAA,WAAW,EAAEc,KAAK,CAAC6C,IAAN,CAAW3D,WAFnB;AAGLa,IAAAA,MAAM,EAAEC,KAAK,CAAC8C,QAAN,CAAe/C,MAHlB;AAIL0C,IAAAA,SAAS,EAAEzC,KAAK,CAAC+C,QAAN,CAAeN,SAJrB;AAKLC,IAAAA,OAAO,EAAE1C,KAAK,CAAC+C,QAAN,CAAeL,OALnB;AAML/C,IAAAA,OAAO,EAAEK,KAAK,CAACgD,oBAAN,CAA2BC;AAN/B,GAAP;AAUD,CAXD;;AAaA,eAAelF,OAAO,CAAC4E,eAAD,CAAP,CAAyBjE,QAAzB,CAAf","sourcesContent":["\nimport React from 'react'\nimport 'react-big-calendar/lib/addons/dragAndDrop/styles.css';\nimport { connect } from \"react-redux\";\nimport TimeTable from './TimeTable';\nimport { roleIdStudent, roleIdParent, roleIdAdmin, roleIdProfessor } from '../../../../../config/config'\nimport { getEventsByEstabAndSchoolYear, getEventsByEstabAndSchoolYearForProf } from \"../../../../../actions/planningActions\";\nimport _ from 'lodash'\nimport moment from 'moment';\nimport IntlMessages from '../../../../../util/IntlMessages';\n\n\nclass ALMANACH extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      establishment: '',\n      establishmentClass: [],\n      classId: null,\n      supplieModal: false,\n      eventId: '',\n      establishmentRooms: []\n    };\n    this.handleChangeClasse = this.handleChangeClasse.bind(this)\n    this.handleChange = this.handleChange.bind(this);\n    this.event = this.event.bind(this);\n  }\n\n  event({ event }) {\n console.log(event);\n \n    return (\n      <div id={'Popover-'+event.id}>\n      <span style={{ alignItems: 'center', margin: 'auto', fontFamily: 'Raleway',fontSize:\"16px\" }} >\n    {event.eventType === \"lesson\" && this.props.userProfile.role_id === roleIdProfessor ? <p><b>{event.subjectName}</b> <br />{event.classeName} <br />{event.roomName}</p>\n         : event.eventType === \"lesson\" && this.props.userProfile.role_id !== roleIdProfessor ? <p><b>{event.subjectName}</b> <br />{event.roomName}<br/>{moment(event.start).format(\"HH:mm\")} - {moment(event.end).format(\"HH:mm\")}</p>\n         : event.eventType === \"exam\" && this.props.userProfile.role_id === roleIdProfessor ? <p> <IntlMessages id=\"components.note.exam\" />: <b>{event.subjectName}</b> <br />{event.classeName} <br />{event.roomName} </p>\n         : event.eventType === \"exam\"  && this.props.userProfile.role_id !== roleIdProfessor? <p> <IntlMessages id=\"components.note.exam\" />: <b>{event.subjectName}</b> <br />{event.roomName} <br />{moment(event.start).format(\"HH:mm\")} - {moment(event.end).format(\"HH:mm\")}</p>   \n         : event.eventType === \"holidays\" ? <p> <b>{event.title}</b></p> \n                : event.eventType === \"schoolVacation\" ? <p><b>{event.title}</b> </p>\n                : event.eventType === \"event\" && this.props.userProfile.role_id === roleIdProfessor  ? <p><b>{event.title}</b> <br />{event.classeName} <br />{event.roomName}</p>\n                  : event.eventType === \"event\" && this.props.userProfile.role_id !== roleIdProfessor  ? <p><b>{event.title}</b> <br />{event.roomName} <br />{moment(event.start).format(\"HH:mm\")} - {moment(event.end).format(\"HH:mm\")}</p>\n                  :\"\"\n                }\n      </span>\n    </div>\n    )\n      \n  }\n  handleChangeClasse = name => event => {\n    this.props.dispatch(\n      getEventsByEstabAndSchoolYear(\n        this.props.userProfile.establishment_id,\n        this.props.userProfile.school_year_id,\n        event.target.value\n      ));\n    this.setState({ classId: event.target.value });\n  };\n  handleChange = name => event => {\n\n    let establishmentClasse = this.props.classes.filter(classe => classe.establishment_id === event.target.value)\n    this.setState({ [name]: event.target.value, establishmentClass: establishmentClasse, events: [], classe: '' });\n  };\n  UNSAFE_componentWillMount() {\n    \n    let inscriptionsData = []\n    if (this.props.userProfile.role_id === roleIdStudent) {\n      inscriptionsData = this.props.userProfile.user.profiles[0].students[0].inscription;\n      let currentInscription = inscriptionsData.filter(element => element.fk_id_school_year === this.props.userProfile.school_year_id)\n    if (!_.isEmpty(currentInscription)) {\n      const classId = currentInscription[0].fk_id_class_v4\n      this.props.dispatch(getEventsByEstabAndSchoolYear(this.props.userProfile.establishment_id,this.props.userProfile.school_year_id,classId));\n    }\n    } else if (this.props.userProfile.role_id === roleIdParent) {\n      //case: parent have one student\n      inscriptionsData = this.props.userProfile.user.profiles[0].parents[0].student_parents[0].student.inscription;\n      let currentInscription = inscriptionsData.filter(element => element.fk_id_school_year === this.props.userProfile.school_year_id)\n      if (!_.isEmpty(currentInscription)) {\n        const classId = currentInscription[0].fk_id_class_v4\n        this.props.dispatch(getEventsByEstabAndSchoolYear(this.props.userProfile.establishment_id,this.props.userProfile.school_year_id,classId));\n      }\n   \n    }else if (this.props.userProfile.role_id === roleIdAdmin){\n      this.setState({establishmentClass: this.props.classes})\n\n    }else if (this.props.userProfile.role_id === roleIdProfessor){\n      this.props.dispatch(getEventsByEstabAndSchoolYearForProf(this.props.userProfile.establishment_id,this.props.userProfile.school_year_id,this.props.userProfile.id));\n    }\n  }\n  componentDidUpdate(prevProps) {\n    if (this.props.userProfile.role_id === roleIdAdmin && prevProps.classes !== this.props.classes) {\n      this.setState({establishmentClass: this.props.classes});\n    }\n  }\n  render() {\n    return (\n\n      <div className=\"app-wrapper\">\n        <TimeTable\n          match={this.props.match}\n          establishments={this.props.establishments}\n          handleChange={this.handleChange}\n          establishment={this.state.establishment}\n          events={this.props.events}\n          handleChangeClasse={this.handleChangeClasse}\n          establishmentClass={this.state.establishmentClass}\n          startTime={this.props.startTime}\n          endTime={this.props.endTime}\n          classId={this.state.classId}\n          event={this.event}\n        />\n      </div>)\n\n  }\n};\nconst mapStateToProps = (state) => {\n  return {\n    establishments: state.establishment.remoteEstablishments,\n    userProfile: state.auth.userProfile,\n    events: state.planning.events,\n    startTime: state.settings.startTime,\n    endTime: state.settings.endTime,\n    classes: state.ClassSettingsReducer.classSettings,\n\n\n  }\n}\n\nexport default connect(mapStateToProps)(ALMANACH); "]},"metadata":{},"sourceType":"module"}