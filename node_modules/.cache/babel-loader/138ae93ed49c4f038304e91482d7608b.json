{"ast":null,"code":"var _jsxFileName = \"/home/oem/Documents/projects/educap-pro/educap-pro-front/src/app/routes/Home/admin/ModalEstablishmentList.js\";\nimport React, { Component } from \"react\";\nimport IntlMessages from \"../../../../util/IntlMessages\";\nimport Auxiliary from \"../../../../util/Auxiliary\";\nimport { Modal, ModalBody, ModalHeader } from \"reactstrap\";\nimport TextField from \"@material-ui/core/TextField\";\nimport Button from \"@material-ui/core/Button\";\nimport { UncontrolledAlert } from \"reactstrap\";\nimport { connect } from \"react-redux\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport { object } from \"prop-types\";\nimport { getThemeColor, getAppLanguage, initCalendar } from \"../../../../actions/Setting\";\nimport { hideModalSelectEstablishment } from \"../../../../actions/Auth\";\nimport _ from \"lodash\";\nimport { getSubjectModules } from \"../../../../actions/SubjectModuleAction\";\nimport { getClassSettings } from \"../../../../actions/ClassSettingsAction\";\nimport { getSection } from \"../../../../actions/SectionsAction\";\nimport { getLevel } from \"../../../../actions/LevelAction\";\nimport { getSubjectSetting } from \"../../../../actions/subjectAction\";\nimport { getAssignementCourse } from \"../../../../actions/AssignementAction\";\nimport { userSignOut, showLicenceMessage, showAuthMessage } from '../../../../actions/Auth';\nimport { roleIdAdmin } from \"../../../../config/config\";\n\nclass ModalEstablishmentList extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleChange = name => event => {\n      this.setState({\n        [name]: event.target.value\n      });\n    };\n\n    this.state = {\n      establishment: \"\"\n    };\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  handleSubmit() {\n    if (_.isEmpty(this.state.establishment.establishment.licence)) {\n      this.props.dispatch(userSignOut());\n\n      if (this.props.userProfile.role_id === roleIdAdmin) {\n        this.props.dispatch(showLicenceMessage('Votre licence a expiré, Merci de contacter le super admin Educap'));\n      } else {\n        this.props.dispatch(showLicenceMessage('Vous avez un problème de paiement, merci de contacter l\\'administrateur de votre école'));\n      }\n    } else {\n      localStorage.setItem(\"establishment_id\", this.state.establishment.establishment_id);\n      this.props.dispatch({\n        type: \"GET_ESTABLISHMENT_MODULE\",\n        payload: this.state.establishment.establishment.establishmentModule\n      }); // if (!_.isEmpty(this.state.establishment.establishment.licence)) {\n\n      localStorage.setItem(\"school_year_id\", this.state.establishment.establishment.licence[0].schoolYear.id);\n      localStorage.setItem(\"school_year_name\", this.state.establishment.establishment.licence[0].schoolYear.name);\n      const userProfile = Object.assign({}, this.props.profile, {\n        establishment_id: this.state.establishment.establishment_id,\n        school_year_id: this.state.establishment.establishment.licence[0].schoolYear.id,\n        school_year_name: this.state.establishment.establishment.licence[0].schoolYear.name\n      });\n      this.props.dispatch({\n        type: \"GET_USER_PROFILE\",\n        payload: userProfile\n      });\n      this.props.dispatch(getSubjectModules(this.state.establishment.establishment_id, this.state.establishment.establishment.licence[0].schoolYear.id));\n      this.props.dispatch(getAssignementCourse(this.state.establishment.establishment_id, this.state.establishment.establishment.licence[0].schoolYear.id));\n      this.props.dispatch(getClassSettings(this.state.establishment.establishment_id, this.state.establishment.establishment.licence[0].schoolYear.id));\n      this.props.dispatch(getSubjectModules(this.state.establishment.establishment_id, this.state.establishment.establishment.licence[0].schoolYear.id));\n      this.props.dispatch(getSection(this.state.establishment.establishment_id, this.state.establishment.establishment.licence[0].schoolYear.id));\n      this.props.dispatch(getLevel(this.state.establishment.establishment_id, this.state.establishment.establishment.licence[0].schoolYear.id));\n      this.props.dispatch(getSubjectSetting(this.state.establishment.establishment_id, this.state.establishment.establishment.licence[0].schoolYear.id)); // } else {\n      //   localStorage.setItem(\"school_year_id\", null);\n      //   localStorage.setItem(\"school_year_name\", \"\");\n      //   const userProfile = Object.assign({}, this.props.profile, {\n      //     establishment_id: this.state.establishment.establishment_id,\n      //     school_year_id: null,\n      //     school_year_name: \"\",\n      //   });\n      //   this.props.dispatch({ type: \"GET_USER_PROFILE\", payload: userProfile });\n      // }\n\n      this.props.dispatch(hideModalSelectEstablishment());\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(Auxiliary, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Modal, {\n      isOpen: this.props.multiple,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ModalHeader, {\n      toggle: this.props.handleCancel,\n      className: \"modal-box-header bg-primary text-white\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(IntlMessages, {\n      id: \"select.establishment.admin\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 14\n      }\n    })), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(ModalBody, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"form\", {\n      autoComplete: \"off\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-12\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(TextField, {\n      required: true,\n      name: \"establishment\",\n      id: \"establishment\",\n      select: true,\n      label: /*#__PURE__*/React.createElement(IntlMessages, {\n        id: \"components.student.formadd.establishment\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 25\n        }\n      }),\n      value: this.state.establishment,\n      onChange: this.handleChange(\"establishment\"),\n      SelectProps: {},\n      margin: \"normal\",\n      fullWidth: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 21\n      }\n    }, this.props.profile.establishments.map(establishment => /*#__PURE__*/React.createElement(MenuItem, {\n      key: establishment.id,\n      value: establishment,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 27\n      }\n    }, establishment.establishment.name)))))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-12 text-left \",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      variant: \"contained\",\n      className: \"jr-btn bg-indigo text-white \",\n      disabled: this.state.establishment === \"\",\n      onClick: this.handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(IntlMessages, {\n      id: \"button.save.registreAppel\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 20\n      }\n    })))))));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    multiple: state.auth.multiple,\n    profile: state.auth.profile,\n    userProfile: state.auth.userProfile\n  };\n};\n\nexport default connect(mapStateToProps)(ModalEstablishmentList);","map":{"version":3,"sources":["/home/oem/Documents/projects/educap-pro/educap-pro-front/src/app/routes/Home/admin/ModalEstablishmentList.js"],"names":["React","Component","IntlMessages","Auxiliary","Modal","ModalBody","ModalHeader","TextField","Button","UncontrolledAlert","connect","MenuItem","object","getThemeColor","getAppLanguage","initCalendar","hideModalSelectEstablishment","_","getSubjectModules","getClassSettings","getSection","getLevel","getSubjectSetting","getAssignementCourse","userSignOut","showLicenceMessage","showAuthMessage","roleIdAdmin","ModalEstablishmentList","constructor","props","handleChange","name","event","setState","target","value","state","establishment","bind","handleSubmit","isEmpty","licence","dispatch","userProfile","role_id","localStorage","setItem","establishment_id","type","payload","establishmentModule","schoolYear","id","Object","assign","profile","school_year_id","school_year_name","render","multiple","handleCancel","establishments","map","mapStateToProps","auth"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport IntlMessages from \"../../../../util/IntlMessages\";\nimport Auxiliary from \"../../../../util/Auxiliary\";\nimport { Modal, ModalBody, ModalHeader } from \"reactstrap\";\nimport TextField from \"@material-ui/core/TextField\";\nimport Button from \"@material-ui/core/Button\";\nimport { UncontrolledAlert } from \"reactstrap\";\nimport { connect } from \"react-redux\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport { object } from \"prop-types\";\nimport {\n  getThemeColor,\n  getAppLanguage,\n  initCalendar,\n} from \"../../../../actions/Setting\";\nimport {\n  hideModalSelectEstablishment,\n} from \"../../../../actions/Auth\";\nimport _ from \"lodash\";\nimport { getSubjectModules } from \"../../../../actions/SubjectModuleAction\";\nimport { getClassSettings } from \"../../../../actions/ClassSettingsAction\";\nimport { getSection } from \"../../../../actions/SectionsAction\";\nimport { getLevel } from \"../../../../actions/LevelAction\";\nimport { getSubjectSetting } from \"../../../../actions/subjectAction\";\nimport { getAssignementCourse } from \"../../../../actions/AssignementAction\";\nimport {userSignOut,showLicenceMessage, showAuthMessage} from '../../../../actions/Auth';\nimport { roleIdAdmin } from \"../../../../config/config\";\n\n\n\nclass ModalEstablishmentList extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      establishment: \"\",\n    };\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n  handleChange = (name) => (event) => {\n    this.setState({\n      [name]: event.target.value,\n    });\n  };\n  handleSubmit() {\n    if(_.isEmpty(this.state.establishment.establishment.licence)){\n      this.props.dispatch(userSignOut())\n      if (this.props.userProfile.role_id === roleIdAdmin) {\n         this.props.dispatch(showLicenceMessage('Votre licence a expiré, Merci de contacter le super admin Educap'))\n\n      } else {\n        this.props.dispatch(showLicenceMessage('Vous avez un problème de paiement, merci de contacter l\\'administrateur de votre école'))\n      }\n    }else{\n      localStorage.setItem(\"establishment_id\",this.state.establishment.establishment_id);\n  \n      this.props.dispatch({\n        type: \"GET_ESTABLISHMENT_MODULE\",\n        payload: this.state.establishment.establishment.establishmentModule,\n      });\n      // if (!_.isEmpty(this.state.establishment.establishment.licence)) {\n        localStorage.setItem(\"school_year_id\",this.state.establishment.establishment.licence[0].schoolYear.id);\n        localStorage.setItem( \"school_year_name\",this.state.establishment.establishment.licence[0].schoolYear.name);\n        const userProfile = Object.assign({}, this.props.profile, {\n          establishment_id: this.state.establishment.establishment_id,\n          school_year_id: this.state.establishment.establishment.licence[0]\n            .schoolYear.id,\n          school_year_name: this.state.establishment.establishment.licence[0]\n            .schoolYear.name,\n        });\n  \n        this.props.dispatch({ type: \"GET_USER_PROFILE\", payload: userProfile });\n  \n        this.props.dispatch(\n          getSubjectModules(\n            this.state.establishment.establishment_id,\n            this.state.establishment.establishment.licence[0].schoolYear.id\n          )\n        );\n        this.props.dispatch(\n          getAssignementCourse(\n            this.state.establishment.establishment_id,\n            this.state.establishment.establishment.licence[0].schoolYear.id\n          )\n        );\n        this.props.dispatch(\n          getClassSettings(\n            this.state.establishment.establishment_id,\n            this.state.establishment.establishment.licence[0].schoolYear.id\n          )\n        );\n        this.props.dispatch(\n          getSubjectModules(\n            this.state.establishment.establishment_id,\n            this.state.establishment.establishment.licence[0].schoolYear.id\n          )\n        );\n        this.props.dispatch(\n          getSection(\n            this.state.establishment.establishment_id,\n            this.state.establishment.establishment.licence[0].schoolYear.id\n          )\n        );\n        this.props.dispatch(\n          getLevel(\n            this.state.establishment.establishment_id,\n            this.state.establishment.establishment.licence[0].schoolYear.id\n          )\n        );\n        this.props.dispatch(\n          getSubjectSetting(\n            this.state.establishment.establishment_id,\n            this.state.establishment.establishment.licence[0].schoolYear.id\n          )\n        );\n      // } else {\n      //   localStorage.setItem(\"school_year_id\", null);\n      //   localStorage.setItem(\"school_year_name\", \"\");\n      //   const userProfile = Object.assign({}, this.props.profile, {\n      //     establishment_id: this.state.establishment.establishment_id,\n      //     school_year_id: null,\n      //     school_year_name: \"\",\n      //   });\n      //   this.props.dispatch({ type: \"GET_USER_PROFILE\", payload: userProfile });\n      // }\n  \n      this.props.dispatch(hideModalSelectEstablishment());\n    }\n   \n  }\n\n  render() {\n    return (\n      <Auxiliary>\n        <Modal isOpen={this.props.multiple}>\n          <ModalHeader\n            toggle={this.props.handleCancel}\n            className=\"modal-box-header bg-primary text-white\"\n          >\n            {<IntlMessages id=\"select.establishment.admin\" />}\n          </ModalHeader>\n          <br />\n          <ModalBody>\n            <form autoComplete=\"off\">\n              <div className=\"row\">\n                <div className=\"col-md-12\">\n                  <div className=\"form-group\">\n                    <TextField\n                      required\n                      name=\"establishment\"\n                      id=\"establishment\"\n                      select\n                      label={\n                        <IntlMessages id=\"components.student.formadd.establishment\" />\n                      }\n                      value={this.state.establishment}\n                      onChange={this.handleChange(\"establishment\")}\n                      SelectProps={{}}\n                      margin=\"normal\"\n                      fullWidth\n                    >\n                      {this.props.profile.establishments.map(\n                        (establishment) => (\n                          <MenuItem\n                            key={establishment.id}\n                            value={establishment}\n                          >\n                            {establishment.establishment.name}\n                          </MenuItem>\n                        )\n                      )}\n                    </TextField>\n                  </div>\n                </div>\n              </div>\n              <div className=\"col-md-12 text-left \">\n                <br />\n                <br />\n                <Button\n                  variant=\"contained\"\n                  className=\"jr-btn bg-indigo text-white \"\n                  disabled={this.state.establishment === \"\"}\n                  onClick={this.handleSubmit}\n                >\n                  {<IntlMessages id=\"button.save.registreAppel\" />}\n                </Button>\n              </div>\n            </form>\n          </ModalBody>\n        </Modal>\n      </Auxiliary>\n    );\n  }\n}\nconst mapStateToProps = (state) => {\n  return {\n    multiple: state.auth.multiple,\n    profile: state.auth.profile,\n    userProfile: state.auth.userProfile,\n  };\n};\n\nexport default connect(mapStateToProps)(ModalEstablishmentList);\n"]},"metadata":{},"sourceType":"module"}