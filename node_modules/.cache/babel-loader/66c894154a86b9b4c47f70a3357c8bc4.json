{"ast":null,"code":"var _jsxFileName = \"/home/oem/Documents/projects/educap-pro/educap-pro-front/src/app/routes/FinancialManagement/routes/Payment/Payments.js\";\nimport React from \"react\";\nimport IntlMessages from '../../../../../util/IntlMessages';\nimport { connect } from \"react-redux\";\nimport { getEstablishment } from \"../../../../../actions/establishmentAction\";\nimport { getClasses, getClassesByEstablishmentId } from \"../../../../../actions/classeAction\";\nimport { getPaymentsForParent, getPaymentsForStudent } from \"../../../../../actions/PaymentAction\";\nimport PaymentFilter from './PaymentFilter';\nimport ContainerHeader from '../../../../../components/ContainerHeader/index';\nimport { roleIdSuperAdmin, roleIdAdmin, roleIdParent, roleIdStudent, roleIdDirector } from '../../../../../config/config';\nimport Fab from '@material-ui/core/Fab';\nimport Input from '@material-ui/icons/Input';\nimport axios from 'axios';\nimport baseUrl from '../../../../../config/config';\nimport moment from 'moment';\nimport Can from '../../../../../can';\nimport { RoleContext } from '../../../../../Context';\n\nclass PropertiesPayment extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      csvData: []\n    };\n    this.exportCsv = this.exportCsv.bind(this);\n  }\n\n  componentWillMount() {\n    axios.get(`${baseUrl.baseUrl}/lines_payments/fetchCsvData/${localStorage.establishment_id}?access_token=${localStorage.token}`).then(response => {\n      this.setState({\n        csvData: response.data.csvData\n      });\n    });\n\n    switch (parseInt(localStorage.roles_id)) {\n      case roleIdSuperAdmin:\n        this.props.dispatch(getEstablishment());\n        this.props.dispatch(getClasses());\n        break;\n\n      case roleIdAdmin:\n      case roleIdDirector:\n        this.props.dispatch(getClassesByEstablishmentId(localStorage.establishment_id));\n        break;\n\n      case roleIdParent:\n        this.props.dispatch(getPaymentsForParent(localStorage.profileId));\n        break;\n\n      case roleIdStudent:\n        this.props.dispatch(getPaymentsForStudent(localStorage.profileId));\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  objectToCsv(data) {\n    const csvRows = [];\n    const headers = Object.keys(data[0]);\n    csvRows.push(headers.join(','));\n\n    for (const row of data) {\n      const values = headers.map(header => {\n        const escaped = ('' + row[header]).replace(/\"/g, '//\"');\n        return `\"${escaped}\"`;\n      });\n      csvRows.push(values.join(','));\n    }\n\n    return csvRows.join('\\n');\n  }\n\n  downLoad(data) {\n    const blob = new Blob([data], {\n      type: 'text/csv'\n    });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.setAttribute('hidden', '');\n    a.setAttribute('href', url);\n    a.setAttribute('download', 'download.csv');\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n  }\n\n  exportCsv() {\n    const csvList = this.state.csvData;\n    const csvListFormated = csvList.map(row => ({\n      name: row.name,\n      surname: row.surname,\n      classeName: row.classeName,\n      seviceName: row.seviceName,\n      prixHT: row.prixHT,\n      prixTTC: row.prixTTC,\n      TVA: row.TVA,\n      expected_day: moment(row.expected_day).format('L'),\n      payment_status: row.payment_status\n    }));\n    const csvData = this.objectToCsv(csvListFormated);\n    this.downLoad(csvData);\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"app-wrapper\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(ContainerHeader, {\n      match: this.props.match,\n      title: /*#__PURE__*/React.createElement(IntlMessages, {\n        id: \"payment.title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 58\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(RoleContext.Consumer, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 9\n      }\n    }, ({\n      role\n    }) => /*#__PURE__*/React.createElement(Can, {\n      role: role,\n      perform: \"payment-export-csv:visit\",\n      yes: () => /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-12 text-right \",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(Fab, {\n        size: \"small\",\n        color: \"primary\",\n        onClick: this.exportCsv,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(Input, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 21\n        }\n      }))),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 13\n      }\n    })), \"\\xA0\\xA0\\xA0\", /*#__PURE__*/React.createElement(PaymentFilter, {\n      establishments: this.props.establishments,\n      classes: this.props.classes,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 9\n      }\n    }));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    establishments: state.establishment.remoteEstablishments,\n    classes: state.classes\n  };\n};\n\nexport default connect(mapStateToProps)(PropertiesPayment);","map":{"version":3,"sources":["/home/oem/Documents/projects/educap-pro/educap-pro-front/src/app/routes/FinancialManagement/routes/Payment/Payments.js"],"names":["React","IntlMessages","connect","getEstablishment","getClasses","getClassesByEstablishmentId","getPaymentsForParent","getPaymentsForStudent","PaymentFilter","ContainerHeader","roleIdSuperAdmin","roleIdAdmin","roleIdParent","roleIdStudent","roleIdDirector","Fab","Input","axios","baseUrl","moment","Can","RoleContext","PropertiesPayment","Component","constructor","props","state","csvData","exportCsv","bind","componentWillMount","get","localStorage","establishment_id","token","then","response","setState","data","parseInt","roles_id","dispatch","profileId","objectToCsv","csvRows","headers","Object","keys","push","join","row","values","map","header","escaped","replace","downLoad","blob","Blob","type","url","window","URL","createObjectURL","a","document","createElement","setAttribute","body","appendChild","click","removeChild","csvList","csvListFormated","name","surname","classeName","seviceName","prixHT","prixTTC","TVA","expected_day","format","payment_status","render","match","role","establishments","classes","mapStateToProps","establishment","remoteEstablishments"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport IntlMessages from '../../../../../util/IntlMessages';\nimport { connect } from \"react-redux\";\nimport { getEstablishment } from \"../../../../../actions/establishmentAction\";\nimport { getClasses, getClassesByEstablishmentId } from \"../../../../../actions/classeAction\";\nimport { getPaymentsForParent, getPaymentsForStudent } from \"../../../../../actions/PaymentAction\";\nimport PaymentFilter from './PaymentFilter';\nimport ContainerHeader from '../../../../../components/ContainerHeader/index';\nimport { roleIdSuperAdmin, roleIdAdmin, roleIdParent, roleIdStudent, roleIdDirector } from '../../../../../config/config';\nimport Fab from '@material-ui/core/Fab';\nimport Input from '@material-ui/icons/Input';\nimport axios from 'axios';\nimport baseUrl from '../../../../../config/config';\nimport moment from 'moment';\nimport Can from '../../../../../can';\nimport { RoleContext } from '../../../../../Context';\n\n\nclass PropertiesPayment extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      csvData: []\n\n    };\n    this.exportCsv = this.exportCsv.bind(this);\n\n  }\n\n  componentWillMount() {\n\n    axios\n      .get(\n        `${baseUrl.baseUrl}/lines_payments/fetchCsvData/${localStorage.establishment_id}?access_token=${localStorage.token}`\n      ).then((response) => {\n        this.setState({ csvData: response.data.csvData })\n      })\n\n    switch (parseInt(localStorage.roles_id)) {\n      case roleIdSuperAdmin:\n        this.props.dispatch(getEstablishment());\n        this.props.dispatch(getClasses());\n        break;\n\n      case roleIdAdmin:\n      case roleIdDirector:\n\n        this.props.dispatch(getClassesByEstablishmentId(localStorage.establishment_id));\n        break;\n\n      case roleIdParent:\n        this.props.dispatch(getPaymentsForParent(localStorage.profileId))\n        break;\n\n      case roleIdStudent:\n        this.props.dispatch(getPaymentsForStudent(localStorage.profileId))\n        break;\n\n      default:\n        break;\n    }\n  }\n  objectToCsv(data) {\n\n    const csvRows = [];\n\n    const headers = Object.keys(data[0]);\n    csvRows.push(headers.join(','));\n\n    for (const row of data) {\n      const values = headers.map(header => {\n        const escaped = ('' + row[header]).replace(/\"/g, '//\"');\n        return `\"${escaped}\"`\n      })\n\n      csvRows.push(values.join(','))\n    }\n    return csvRows.join('\\n');\n\n  }\n  downLoad(data) {\n    const blob = new Blob([data], { type: 'text/csv' });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.setAttribute('hidden', '');\n    a.setAttribute('href', url);\n    a.setAttribute('download', 'download.csv');\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n\n\n\n  }\n  exportCsv() {\n    const csvList = this.state.csvData;\n    const csvListFormated = csvList.map(row => ({\n      name: row.name,\n      surname: row.surname,\n      classeName: row.classeName,\n      seviceName: row.seviceName,\n      prixHT: row.prixHT,\n      prixTTC: row.prixTTC,\n      TVA: row.TVA,\n      expected_day: moment(row.expected_day).format('L'),\n      payment_status: row.payment_status\n\n    }))\n    const csvData = this.objectToCsv(csvListFormated);\n    this.downLoad(csvData);\n  }\n\n  render() {\n    return (\n\n      <div className=\"app-wrapper\">\n        <ContainerHeader match={this.props.match} title={<IntlMessages id=\"payment.title\" />} />\n\n        <RoleContext.Consumer>\n          {({ role }) => (\n            <Can\n              role={role}\n              perform=\"payment-export-csv:visit\"\n              yes={() => (\n                <div className=\"col-md-12 text-right \">\n                  <Fab\n                    size=\"small\"\n                    color=\"primary\"\n                    onClick={this.exportCsv}\n                  >\n                    <Input />\n                  </Fab>\n                </div>\n\n              )}\n            />\n          )\n          }\n        </RoleContext.Consumer>\n\n        &nbsp;&nbsp;&nbsp;\n        <PaymentFilter establishments={this.props.establishments} classes={this.props.classes} />\n      </div>\n\n    );\n  }\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    establishments: state.establishment.remoteEstablishments,\n    classes: state.classes,\n\n  }\n}\n\nexport default connect(mapStateToProps)(PropertiesPayment);\n"]},"metadata":{},"sourceType":"module"}