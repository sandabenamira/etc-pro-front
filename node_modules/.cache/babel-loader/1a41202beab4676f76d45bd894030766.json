{"ast":null,"code":"var _jsxFileName = \"/home/oem/Documents/projects/educap-pro/educap-pro-front/src/app/routes/Superadmin/SchoolLicence/SchoolLicence.js\";\nimport React from \"react\";\nimport CardBox from \"../../../../components/CardBox/index\";\nimport { connect } from \"react-redux\";\nimport AddSchoolLicence from \"./AddSchoolLicence\";\nimport SchoolLicenceList from \"./SchoolLicenceList\";\nimport { UncontrolledAlert } from \"reactstrap\";\nimport { addSchoolLicence, getSchoolLicence } from \"../../../../actions/SchoolLicenceAction\";\nimport { getModules } from \"../../../../actions/ModuleAction\";\nimport IntlMessages from \"../../../../util/IntlMessages\";\nimport _ from \"lodash\";\n\nclass SchoolLicence extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleChangeEstablishment = name => event => {\n      let ListEstablishment = this.props.listEstablishments;\n      this.setState({\n        [name]: event.target.value,\n        ListEstablishment\n      });\n    };\n\n    this.handleChangeSchoolYears = name => event => {\n      let ListSchoolYear = this.props.schoolYearList;\n      this.setState({\n        [name]: event.target.value,\n        ListSchoolYear\n      });\n    };\n\n    this.handleChange = name => event => {\n      const item = event.target.value;\n\n      if (name === \"establishementId\") {\n        this.setState({\n          establishementId: item.id,\n          establishment: item\n        });\n      } else {\n        this.setState({\n          [name]: event.target.value\n        });\n      }\n    };\n\n    this.handleChangeAlerte = name => {\n      this.setState({\n        licenceExist: true,\n        messageAlerte: \"Il existe déja une licence pour cet etablissement\"\n      });\n      setTimeout(() => {\n        this.setState({\n          licenceExist: false,\n          messageAlerte: \"\"\n        });\n      }, 4000);\n    };\n\n    this.handleChangeModule = event => {\n      this.setState({\n        modules: event.target.value\n      });\n    };\n\n    this.state = {\n      isOpen: false,\n      start_date: new Date(),\n      end_date: new Date(),\n      establishementId: \"\",\n      schoolYearId: \"\",\n      situationLicence: \"\",\n      licenceGroup: [{\n        value: \"Actif\",\n        label: \"Active\"\n      }, {\n        value: \"Expired\",\n        label: \"Expiré\"\n      }, {\n        value: \"Pending\",\n        label: \"En cours\"\n      }, {\n        value: \"Blocked\",\n        label: \"Bloqué\"\n      }],\n      paymentMode: [{\n        value: \"Semestre\",\n        label: /*#__PURE__*/React.createElement(IntlMessages, {\n          id: \"mode_payment.establishment.semester\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 46,\n            columnNumber: 18\n          }\n        })\n      }, {\n        value: \"Trimestre\",\n        label: /*#__PURE__*/React.createElement(IntlMessages, {\n          id: \"mode_payment.establishment.trimester\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 50,\n            columnNumber: 18\n          }\n        })\n      }, {\n        value: \"Mensuel\",\n        label: /*#__PURE__*/React.createElement(IntlMessages, {\n          id: \"mode_payment.establishment.monthly\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 54,\n            columnNumber: 18\n          }\n        })\n      }, {\n        value: \"Annuel\",\n        label: /*#__PURE__*/React.createElement(IntlMessages, {\n          id: \"mode_payment.establishment.annual\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 58,\n            columnNumber: 18\n          }\n        })\n      }],\n      licenceType: \"\",\n      establishment: \"\",\n      modules: [],\n      studentsNumber: \"\",\n      paymentMode: \"\",\n      smsNumber: \"\",\n      emptyFields: false,\n      licenceExist: false,\n      messageAlerte: \"\"\n    };\n    this.openAddModal = this.openAddModal.bind(this);\n    this.handleCancel = this.handleCancel.bind(this);\n    this.openAddModal = this.openAddModal.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleArchive = this.handleArchive.bind(this);\n    this.handleChangeAlerte = this.handleChangeAlerte.bind(this);\n  }\n\n  handleCancel() {\n    this.setState({\n      isOpen: false\n    });\n  }\n\n  openAddModal() {\n    this.setState({\n      isOpen: true\n    });\n  }\n\n  openAddModal() {\n    this.setState(previousState => ({\n      isOpen: !previousState.isOpen\n    }));\n  }\n\n  handleSubmit(event) {\n    event.preventDefault();\n\n    if (_.isEmpty(this.state.establishementId) && _.isEmpty(this.state.schoolYearId) && _.isEmpty(this.state.licenceType) && _.isEmpty(this.state.paymentMode)) {\n      this.setState({\n        emptyFields: true,\n        messageAlerte: \"Veuillez remplir tous les champs obligatoires\"\n      });\n      setTimeout(() => {\n        this.setState({\n          emptyFields: false,\n          messageAlerte: \"\"\n        });\n      }, 4000);\n    } else {\n      let checkDoubleLicence = this.props.schoolLicences.filter(element => element.fk_id_establishment == this.state.establishementId && element.fk_id_school_year == this.state.schoolYearId);\n\n      if (checkDoubleLicence.length > 0) {\n        this.setState({\n          licenceExist: true,\n          messageAlerte: \"Il existe déja une licence pour cet etablissement\"\n        });\n        setTimeout(() => {\n          this.setState({\n            licenceExist: false,\n            messageAlerte: \"\"\n          });\n        }, 4000);\n      } else {\n        let data = {\n          fk_id_school_year: this.state.schoolYearId,\n          fk_id_establishment: this.state.establishementId,\n          situation: this.state.licenceType,\n          number_students: this.state.studentsNumber,\n          mode_payment: this.state.paymentMode,\n          number_sms: this.state.smsNumber,\n          modules: this.state.modules\n        };\n        this.props.dispatch(addSchoolLicence(data, this.state.establishment, this.state.modules));\n        this.props.dispatch(getModules());\n        this.openAddModal();\n        this.setState({\n          licenceType: \"\",\n          schoolYearId: \"\",\n          establishementId: \"\",\n          studentsNumber: \"\",\n          paymentMode: \"\",\n          smsNumber: \"\",\n          establishment: \"\",\n          modules: []\n        });\n      }\n    }\n  }\n\n  handleArchive(event) {\n    event.preventDefault();\n    this.openAddModal();\n    this.setState({});\n  }\n\n  UNSAFE_componentWillMount() {\n    this.props.dispatch(getSchoolLicence(this.props.userProfile.school_year_id));\n    this.props.dispatch(getModules());\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.userProfile !== this.props.userProfile) {\n      this.props.dispatch(getSchoolLicence(this.props.userProfile.school_year_id));\n      this.props.dispatch(getModules());\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"app-wrapper\",\n      style: {\n        marginLeft: \"5%\",\n        marginRight: \"10%\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"  d-flex flex-column mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 9\n      }\n    }, this.props.successStatus ? /*#__PURE__*/React.createElement(UncontrolledAlert, {\n      className: \"alert-addon-card bg-success bg-success text-white shadow-lg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"icon-addon alert-addon\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"zmdi zmdi-cloud-done zmdi-hc-fw zmdi-hc-lg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"d-inline-block\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 15\n      }\n    }, \" \", this.props.message, \" \")) : \"\", this.state.licenceExist || this.state.emptyFields == true ? /*#__PURE__*/React.createElement(UncontrolledAlert, {\n      className: \"alert-addon-card bg-danger bg-danger text-white shadow-lg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"icon-addon alert-addon\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"zmdi zmdi-cloud-done zmdi-hc-fw zmdi-hc-lg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"d-inline-block\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 15\n      }\n    }, \" \", this.state.messageAlerte, \" \")) : \"\", /*#__PURE__*/React.createElement(\"div\", {\n      className: \" bd-highlight\",\n      style: {\n        width: \"90%\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(CardBox, {\n      styleName: \"col-lg-12\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(AddSchoolLicence, {\n      values: this.state,\n      openAddModal: this.openAddModal,\n      handleCancel: this.handleCancel,\n      handleChange: this.handleChange,\n      handleSubmit: this.handleSubmit,\n      handleArchive: this.handleArchive,\n      handleChangeEstablishment: this.handleChangeEstablishment,\n      handleChangeSchoolYears: this.handleChangeSchoolYears,\n      handleChangeModule: this.handleChangeModule,\n      moduleList: this.props.modules,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 15\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \" bd-highlight\",\n      style: {\n        width: \"90%\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(CardBox, {\n      styleName: \"col-lg-12\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(SchoolLicenceList, {\n      handleChangeEstablishment: this.handleChangeEstablishment,\n      handleChangeSchoolYears: this.handleChangeSchoolYears,\n      schoolLicences: this.props.schoolLicences,\n      listEstablishments: this.props.establishmentsList,\n      schoolYearList: this.props.schoolYearList,\n      handleAnnule: this.handleAnnule,\n      handleChange: this.handleChange,\n      handleSubmit: this.handleSubmit,\n      handleToggle: this.handleToggle,\n      handleChangeAlerte: this.handleChangeAlerte,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 15\n      }\n    })))));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    userProfile: state.auth.userProfile,\n    successStatus: state.alert.success,\n    errorStatus: state.alert.error,\n    message: state.alert.message,\n    schoolLicences: state.SchoolLicenceReducer.schoolLicences,\n    establishmentsList: state.establishment.remoteEstablishments,\n    schoolYearList: state.schoolYearEtab.remoteSchoolYearEtab,\n    modules: state.module.remoteModules\n  };\n};\n\nexport default connect(mapStateToProps)(SchoolLicence);","map":{"version":3,"sources":["/home/oem/Documents/projects/educap-pro/educap-pro-front/src/app/routes/Superadmin/SchoolLicence/SchoolLicence.js"],"names":["React","CardBox","connect","AddSchoolLicence","SchoolLicenceList","UncontrolledAlert","addSchoolLicence","getSchoolLicence","getModules","IntlMessages","_","SchoolLicence","Component","constructor","props","handleChangeEstablishment","name","event","ListEstablishment","listEstablishments","setState","target","value","handleChangeSchoolYears","ListSchoolYear","schoolYearList","handleChange","item","establishementId","id","establishment","handleChangeAlerte","licenceExist","messageAlerte","setTimeout","handleChangeModule","modules","state","isOpen","start_date","Date","end_date","schoolYearId","situationLicence","licenceGroup","label","paymentMode","licenceType","studentsNumber","smsNumber","emptyFields","openAddModal","bind","handleCancel","handleSubmit","handleArchive","previousState","preventDefault","isEmpty","checkDoubleLicence","schoolLicences","filter","element","fk_id_establishment","fk_id_school_year","length","data","situation","number_students","mode_payment","number_sms","dispatch","UNSAFE_componentWillMount","userProfile","school_year_id","componentDidUpdate","prevProps","render","marginLeft","marginRight","successStatus","message","width","establishmentsList","handleAnnule","handleToggle","mapStateToProps","auth","alert","success","errorStatus","error","SchoolLicenceReducer","remoteEstablishments","schoolYearEtab","remoteSchoolYearEtab","module","remoteModules"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport CardBox from \"../../../../components/CardBox/index\";\nimport { connect } from \"react-redux\";\nimport AddSchoolLicence from \"./AddSchoolLicence\";\nimport SchoolLicenceList from \"./SchoolLicenceList\";\nimport { UncontrolledAlert } from \"reactstrap\";\nimport {\n  addSchoolLicence,\n  getSchoolLicence,\n} from \"../../../../actions/SchoolLicenceAction\";\nimport { getModules } from \"../../../../actions/ModuleAction\";\nimport IntlMessages from \"../../../../util/IntlMessages\";\nimport _ from \"lodash\";\n\nclass SchoolLicence extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isOpen: false,\n      start_date: new Date(),\n      end_date: new Date(),\n      establishementId: \"\",\n      schoolYearId: \"\",\n      situationLicence: \"\",\n      licenceGroup: [\n        {\n          value: \"Actif\",\n          label: \"Active\",\n        },\n        {\n          value: \"Expired\",\n          label: \"Expiré\",\n        },\n        {\n          value: \"Pending\",\n          label: \"En cours\",\n        },\n        {\n          value: \"Blocked\",\n          label: \"Bloqué\",\n        },\n      ],\n      paymentMode: [\n        {\n          value: \"Semestre\",\n          label: <IntlMessages id=\"mode_payment.establishment.semester\" />,\n        },\n        {\n          value: \"Trimestre\",\n          label: <IntlMessages id=\"mode_payment.establishment.trimester\" />,\n        },\n        {\n          value: \"Mensuel\",\n          label: <IntlMessages id=\"mode_payment.establishment.monthly\" />,\n        },\n        {\n          value: \"Annuel\",\n          label: <IntlMessages id=\"mode_payment.establishment.annual\" />,\n        },\n      ],\n      licenceType: \"\",\n      establishment: \"\",\n      modules: [],\n      studentsNumber: \"\",\n      paymentMode: \"\",\n      smsNumber: \"\",\n      emptyFields: false,\n      licenceExist: false,\n      messageAlerte:\"\"\n\n    };\n    this.openAddModal = this.openAddModal.bind(this);\n    this.handleCancel = this.handleCancel.bind(this);\n    this.openAddModal = this.openAddModal.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleArchive = this.handleArchive.bind(this);\n    this.handleChangeAlerte = this.handleChangeAlerte.bind(this);\n  }\n  handleCancel() {\n    this.setState({ isOpen: false });\n  }\n  openAddModal() {\n    this.setState({ isOpen: true });\n  }\n  openAddModal() {\n    this.setState((previousState) => ({\n      isOpen: !previousState.isOpen,\n    }));\n  }\n  handleSubmit(event) {\n    event.preventDefault();\n    if (\n      _.isEmpty(this.state.establishementId) &&\n      _.isEmpty(this.state.schoolYearId) &&\n      _.isEmpty(this.state.licenceType) &&\n      _.isEmpty(this.state.paymentMode)\n    ) {\n      this.setState({\n        emptyFields: true,\n        messageAlerte: \"Veuillez remplir tous les champs obligatoires\",\n      });\n      setTimeout(() => {\n        this.setState({ emptyFields: false, messageAlerte: \"\" });\n      }, 4000);\n    } else {\n      let checkDoubleLicence = this.props.schoolLicences.filter(\n        (element) =>\n          element.fk_id_establishment == this.state.establishementId &&\n          element.fk_id_school_year == this.state.schoolYearId\n      );\n       if (checkDoubleLicence.length > 0) {\n         this.setState({\n          licenceExist: true,\n          messageAlerte: \"Il existe déja une licence pour cet etablissement\",\n        });\n        setTimeout(() => {\n          this.setState({ licenceExist: false, messageAlerte: \"\" });\n        }, 4000);\n      } else {\n        let data = {\n          fk_id_school_year: this.state.schoolYearId,\n          fk_id_establishment: this.state.establishementId,\n          situation: this.state.licenceType,\n          number_students: this.state.studentsNumber,\n          mode_payment: this.state.paymentMode,\n          number_sms: this.state.smsNumber,\n          modules: this.state.modules,\n        };\n          this.props.dispatch(\n            addSchoolLicence(data, this.state.establishment, this.state.modules)\n          );\n         this.props.dispatch(getModules());\n\n        this.openAddModal();\n        this.setState({\n          licenceType: \"\",\n          schoolYearId: \"\",\n          establishementId: \"\",\n          studentsNumber: \"\",\n          paymentMode: \"\",\n          smsNumber: \"\",\n          establishment: \"\",\n          modules: [],\n        });\n      }\n    }\n  }\n  handleChangeEstablishment = (name) => (event) => {\n    let ListEstablishment = this.props.listEstablishments;\n    this.setState({ [name]: event.target.value, ListEstablishment });\n  };\n  handleChangeSchoolYears = (name) => (event) => {\n    let ListSchoolYear = this.props.schoolYearList;\n    this.setState({ [name]: event.target.value, ListSchoolYear });\n  };\n  handleArchive(event) {\n    event.preventDefault();\n    this.openAddModal();\n    this.setState({});\n  }\n\n  handleChange = (name) => (event) => {\n    const item = event.target.value;\n    if (name === \"establishementId\") {\n      this.setState({ establishementId: item.id, establishment: item });\n    } else {\n      this.setState({ [name]: event.target.value });\n    }\n  };\n  handleChangeAlerte = (name)  => {\n    this.setState({\n      licenceExist: true,\n      messageAlerte: \"Il existe déja une licence pour cet etablissement\",\n    });\n    setTimeout(() => {\n      this.setState({ licenceExist: false, messageAlerte: \"\" });\n    }, 4000);\n  };\n\n  UNSAFE_componentWillMount() {\n    this.props.dispatch(\n      getSchoolLicence(this.props.userProfile.school_year_id)\n    );\n    this.props.dispatch(getModules());\n  }\n  componentDidUpdate(prevProps) {\n    if (prevProps.userProfile !== this.props.userProfile) {\n      this.props.dispatch(\n        getSchoolLicence(this.props.userProfile.school_year_id)\n      );\n      this.props.dispatch(getModules());\n    }\n  }\n\n  handleChangeModule = (event) => {\n    this.setState({ modules: event.target.value });\n  };\n  render() {\n    return (\n      <div\n        className=\"app-wrapper\"\n        style={{\n          marginLeft: \"5%\",\n          marginRight: \"10%\",\n        }}\n      >\n        <div className=\"  d-flex flex-column mb-3\">\n          {this.props.successStatus ? (\n            <UncontrolledAlert className=\"alert-addon-card bg-success bg-success text-white shadow-lg\">\n              <span className=\"icon-addon alert-addon\">\n                <i className=\"zmdi zmdi-cloud-done zmdi-hc-fw zmdi-hc-lg\" />\n              </span>\n              <span className=\"d-inline-block\"> {this.props.message} </span>\n            </UncontrolledAlert>\n          ) : (\n            \"\"\n          )}\n          {this.state.licenceExist || this.state.emptyFields == true ? (\n            <UncontrolledAlert className=\"alert-addon-card bg-danger bg-danger text-white shadow-lg\">\n              <span className=\"icon-addon alert-addon\">\n                <i className=\"zmdi zmdi-cloud-done zmdi-hc-fw zmdi-hc-lg\" />\n              </span>\n              <span className=\"d-inline-block\">\n                {\" \"}\n                {this.state.messageAlerte}{\" \"}\n              </span>\n            </UncontrolledAlert>\n          ) : (\n            \"\"\n          )}\n          <div className=\" bd-highlight\" style={{ width: \"90%\" }}>\n            <CardBox styleName=\"col-lg-12\">\n              <AddSchoolLicence\n                values={this.state}\n                openAddModal={this.openAddModal}\n                handleCancel={this.handleCancel}\n                handleChange={this.handleChange}\n                handleSubmit={this.handleSubmit}\n                handleArchive={this.handleArchive}\n                handleChangeEstablishment={this.handleChangeEstablishment}\n                handleChangeSchoolYears={this.handleChangeSchoolYears}\n                handleChangeModule={this.handleChangeModule}\n                moduleList={this.props.modules}\n              />\n            </CardBox>\n          </div>\n          <div className=\" bd-highlight\" style={{ width: \"90%\" }}>\n            <CardBox styleName=\"col-lg-12\">\n              <SchoolLicenceList\n                handleChangeEstablishment={this.handleChangeEstablishment}\n                handleChangeSchoolYears={this.handleChangeSchoolYears}\n                schoolLicences={this.props.schoolLicences}\n                listEstablishments={this.props.establishmentsList}\n                schoolYearList={this.props.schoolYearList}\n                handleAnnule={this.handleAnnule}\n                handleChange={this.handleChange}\n                handleSubmit={this.handleSubmit}\n                handleToggle={this.handleToggle}\n                handleChangeAlerte={this.handleChangeAlerte}\n              />\n            </CardBox>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    userProfile: state.auth.userProfile,\n    successStatus: state.alert.success,\n    errorStatus: state.alert.error,\n    message: state.alert.message,\n    schoolLicences: state.SchoolLicenceReducer.schoolLicences,\n    establishmentsList: state.establishment.remoteEstablishments,\n\n    schoolYearList: state.schoolYearEtab.remoteSchoolYearEtab,\n    modules: state.module.remoteModules,\n  };\n};\n\nexport default connect(mapStateToProps)(SchoolLicence);\n"]},"metadata":{},"sourceType":"module"}