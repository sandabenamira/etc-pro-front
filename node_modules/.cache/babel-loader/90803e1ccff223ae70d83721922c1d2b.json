{"ast":null,"code":"import baseUrl from \"../config/config\";\nimport axios from \"axios\";\nimport { FETCH_ALL_ROLE, ADD_USER, GET_ALL_USERS, EDIT_USER, DELETE_USER, SHOW_ERROR_MESSAGE, HIDE_ERROR_MESSAGE, HIDE_SUCCESS_MESSAGE, SHOW_SUCCESS_MESSAGE, HIDE_WARNING_MESSAGE, SHOW_WARNING_MESSAGE, SHOW_LOADER, HIDE_LOADER } from \"../constants/ActionTypes\";\nimport _ from \"lodash\";\nimport { getError } from \"../Error/Error\";\nimport { classService } from \"../_services/class.service\";\nimport { roleIdStudent } from \"../config/config\";\nexport function getAllRole() {\n  return function (dispatch) {\n    axios.get(`${baseUrl.baseUrl}/roles?access_token=${localStorage.token}`).then(res => {\n      dispatch({\n        type: FETCH_ALL_ROLE,\n        payload: res.data\n      });\n    });\n  };\n}\nexport const addUsers = data => {\n  return dispatch => {\n    let dataUser = {\n      name: data.name,\n      surname: data.surname,\n      gender: data.gender,\n      dateOfBirth: data.dateOfBirth,\n      address: data.address,\n      phone: data.phone,\n      cin: data.cin,\n      zipCode: data.zipCode,\n      country: data.userCountry,\n      photo: data.photo,\n      name_ar: data.name_ar,\n      surname_ar: data.surname_ar,\n      creation_date: new Date(),\n      nationality: data.nationality,\n      placeOfBirth: data.placeOfBirth,\n      email: data.email,\n      roleId: data.roleId,\n      establishmentId: data.establishmentId,\n      assignClassSubject: data.assignClassSubject,\n      classId: data.studentClass,\n      schoolYearId: data.schoolyearId,\n      paperFiles: null,\n      creation_date: Date() // functionName:data.functionName\n\n    };\n    let apiEndpoint = `/users/createByRole?access_token=${localStorage.token}`;\n    classService.post(apiEndpoint, dataUser).then(response => {\n      let userId = response.data.existe.userData.id;\n\n      if (data.userPhoto.name != undefined) {\n        let photoUser = data.userPhoto;\n        var object = {};\n        object.file = photoUser;\n        object.fileName = \"user\" + userId;\n        const myNewFile = new File([object.file], photoUser.name, {\n          type: object.file.type\n        });\n        let formadata = new FormData();\n        formadata.append(\"file\", myNewFile);\n        dispatch({\n          type: SHOW_LOADER,\n          payload: true\n        });\n        const photoUrl = `${baseUrl.baseUrl}/containers/classebook.data.storage/upload?access_token=${localStorage.token}`;\n        axios({\n          url: photoUrl,\n          method: \"POST\",\n          data: formadata\n        }).then(response => {\n          let urlPhotoUser = `${baseUrl.baseUrl}/users/` + userId + `?access_token=${localStorage.token}`;\n          axios.patch(urlPhotoUser, {\n            id: userId,\n            photo: response.data.result.files.file[0].providerResponse.location\n          }).then(response => {\n            if (response) {\n              console.log(\"response photo\", response);\n            } else {\n              console.log(response.data, \"photo not upload\");\n            }\n          });\n        });\n      }\n\n      if (response && data.userPapiersFiles.length > 0) {\n        let formadata = new FormData();\n        data.userPapiersFiles.map((element, index) => {\n          let userPapiersFile = element;\n          const fileExtension = userPapiersFile.name.replace(/^.*\\./, \"\");\n          const fileName = \"userPapiersfile\" + userId + index + String(Date.now()).slice(-2) + \".\" + fileExtension;\n          var object = {};\n          object.file = userPapiersFile;\n          object.fileName = fileName;\n          const myNewFile = new File([object.file], fileName, {\n            type: object.file.type\n          });\n          formadata.append(\"file\", myNewFile);\n        });\n        let filesURL = [];\n        const URLUserPapiersFiles = `${baseUrl.baseUrl}/containers/classebook.data.storage/upload?access_token=${localStorage.token}`;\n        axios({\n          url: URLUserPapiersFiles,\n          method: \"POST\",\n          data: formadata\n        }).then(response => {\n          if (response) {\n            filesURL = response.data.result.files.file.map((urlFile, index) => {\n              return urlFile.providerResponse.location;\n            });\n            let urlPhotoUser = `${baseUrl.baseUrl}/users/` + userId + `?access_token=${localStorage.token}`;\n            axios.patch(urlPhotoUser, {\n              id: userId,\n              paper_files: filesURL\n            }).then(response => {\n              if (response) {\n                console.log(\"response photo\", response);\n              } else {\n                console.log(response.data, \"photo not upload\");\n              }\n            });\n          }\n        }).catch(err => {});\n      } else if (!response) {\n        console.log(\"ereeeu\", response);\n        dispatch({\n          type: SHOW_ERROR_MESSAGE,\n          payload: \"Une erreur est survenue lors de la création merci d'essayer à nouveau\"\n        });\n        setTimeout(() => {\n          dispatch({\n            type: HIDE_ERROR_MESSAGE\n          });\n        }, 4000);\n      }\n    });\n  };\n};","map":{"version":3,"sources":["/home/oem/Documents/projects/educap/classebook-front-web/src/actions/usersAction.js"],"names":["baseUrl","axios","FETCH_ALL_ROLE","ADD_USER","GET_ALL_USERS","EDIT_USER","DELETE_USER","SHOW_ERROR_MESSAGE","HIDE_ERROR_MESSAGE","HIDE_SUCCESS_MESSAGE","SHOW_SUCCESS_MESSAGE","HIDE_WARNING_MESSAGE","SHOW_WARNING_MESSAGE","SHOW_LOADER","HIDE_LOADER","_","getError","classService","roleIdStudent","getAllRole","dispatch","get","localStorage","token","then","res","type","payload","data","addUsers","dataUser","name","surname","gender","dateOfBirth","address","phone","cin","zipCode","country","userCountry","photo","name_ar","surname_ar","creation_date","Date","nationality","placeOfBirth","email","roleId","establishmentId","assignClassSubject","classId","studentClass","schoolYearId","schoolyearId","paperFiles","apiEndpoint","post","response","userId","existe","userData","id","userPhoto","undefined","photoUser","object","file","fileName","myNewFile","File","formadata","FormData","append","photoUrl","url","method","urlPhotoUser","patch","result","files","providerResponse","location","console","log","userPapiersFiles","length","map","element","index","userPapiersFile","fileExtension","replace","String","now","slice","filesURL","URLUserPapiersFiles","urlFile","paper_files","catch","err","setTimeout"],"mappings":"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","sourcesContent":["import baseUrl from \"../config/config\";\nimport axios from \"axios\";\nimport {\n  FETCH_ALL_ROLE,\n  ADD_USER,\n  GET_ALL_USERS,\n  EDIT_USER,\n  DELETE_USER,\n  SHOW_ERROR_MESSAGE,\n  HIDE_ERROR_MESSAGE,\n  HIDE_SUCCESS_MESSAGE,\n  SHOW_SUCCESS_MESSAGE,\n  HIDE_WARNING_MESSAGE,\n  SHOW_WARNING_MESSAGE,\n  SHOW_LOADER,\n  HIDE_LOADER,\n} from \"../constants/ActionTypes\";\nimport _ from \"lodash\";\nimport { getError } from \"../Error/Error\";\nimport { classService } from \"../_services/class.service\";\nimport { roleIdStudent } from \"../config/config\";\n\nexport function getAllRole() {\n  return function(dispatch) {\n    axios\n      .get(`${baseUrl.baseUrl}/roles?access_token=${localStorage.token}`)\n      .then((res) => {\n        dispatch({ type: FETCH_ALL_ROLE, payload: res.data });\n      });\n  };\n}\n\nexport const addUsers = (data) => {\n  return (dispatch) => {\n    let dataUser = {\n      name: data.name,\n      surname: data.surname,\n      gender: data.gender,\n      dateOfBirth: data.dateOfBirth,\n      address: data.address,\n      phone: data.phone,\n      cin: data.cin,\n      zipCode: data.zipCode,\n      country:data.userCountry,\n      photo: data.photo,\n      name_ar: data.name_ar,\n      surname_ar: data.surname_ar,\n      creation_date: new Date(),\n      nationality: data.nationality,\n      placeOfBirth: data.placeOfBirth,\n      email: data.email,\n      roleId: data.roleId,\n      establishmentId: data.establishmentId,\n      assignClassSubject: data.assignClassSubject,\n      classId: data.studentClass,\n      schoolYearId: data.schoolyearId,\n      paperFiles: null,\n      creation_date: Date(),\n      // functionName:data.functionName\n    };\n    let apiEndpoint = `/users/createByRole?access_token=${localStorage.token}`;\n    classService.post(apiEndpoint, dataUser).then((response) => {\n      let userId = response.data.existe.userData.id;\n      if (data.userPhoto.name != undefined) {\n        let photoUser = data.userPhoto;\n        var object = {};\n        object.file = photoUser;\n        object.fileName = \"user\" + userId;\n        const myNewFile = new File([object.file], photoUser.name, {\n          type: object.file.type,\n        });\n        let formadata = new FormData();\n        formadata.append(\"file\", myNewFile);\n        dispatch({\n          type: SHOW_LOADER,\n          payload: true,\n        });\n        const photoUrl = `${baseUrl.baseUrl}/containers/classebook.data.storage/upload?access_token=${localStorage.token}`;\n        axios({\n          url: photoUrl,\n          method: \"POST\",\n          data: formadata,\n        }).then((response) => {\n           let urlPhotoUser =\n            `${baseUrl.baseUrl}/users/` +\n            userId +\n            `?access_token=${localStorage.token}`;\n\n          axios\n            .patch(urlPhotoUser, {\n              id: userId,\n              photo:\n                response.data.result.files.file[0].providerResponse.location,\n            })\n            .then((response) => {\n              if (response) {\n                console.log(\"response photo\", response);\n              } else {\n                console.log(response.data, \"photo not upload\");\n              }\n            });\n        });\n      }\n      if (response && data.userPapiersFiles.length > 0) {\n        let formadata = new FormData();\n        data.userPapiersFiles.map((element, index) => {\n          let userPapiersFile = element;\n          const fileExtension = userPapiersFile.name.replace(/^.*\\./, \"\");\n          const fileName =\n            \"userPapiersfile\" +\n            userId +\n            index +\n            String(Date.now()).slice(-2) +\n            \".\" +\n            fileExtension;\n          var object = {};\n          object.file = userPapiersFile;\n          object.fileName = fileName;\n          const myNewFile = new File([object.file], fileName, {\n            type: object.file.type,\n          });\n          formadata.append(\"file\", myNewFile);\n        });\n\n        let filesURL = [];\n\n        const URLUserPapiersFiles = `${baseUrl.baseUrl}/containers/classebook.data.storage/upload?access_token=${localStorage.token}`;\n        axios({\n          url: URLUserPapiersFiles,\n          method: \"POST\",\n          data: formadata,\n        })\n          .then((response) => {\n            if (response) {\n              filesURL = response.data.result.files.file.map(\n                (urlFile, index) => {\n                  return urlFile.providerResponse.location;\n                }\n              );\n              let urlPhotoUser =\n                `${baseUrl.baseUrl}/users/` +\n                userId +\n                `?access_token=${localStorage.token}`;\n\n              axios\n                .patch(urlPhotoUser, {\n                  id: userId,\n                  paper_files: filesURL,\n                })\n                .then((response) => {\n                  if (response) {\n                    console.log(\"response photo\", response);\n                  } else {\n                    console.log(response.data, \"photo not upload\");\n                  }\n                });\n            }\n          })\n          .catch((err) => {});\n      } else if (!response) {\n        console.log(\"ereeeu\", response);\n        dispatch({\n          type: SHOW_ERROR_MESSAGE,\n          payload:\n            \"Une erreur est survenue lors de la création merci d'essayer à nouveau\",\n        });\n        setTimeout(() => {\n          dispatch({ type: HIDE_ERROR_MESSAGE });\n        }, 4000);\n      }\n    });\n  };\n};\n"]},"metadata":{},"sourceType":"module"}