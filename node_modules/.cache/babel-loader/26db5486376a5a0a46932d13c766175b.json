{"ast":null,"code":"var _jsxFileName = \"/home/oem/Documents/projects/educap/classebook-front-web/src/app/routes/RegistreAppel/StudentList/StudentList.js\";\nimport React, { Component } from 'react';\nimport StudentItem from './StudentItem';\nimport Button from '@material-ui/core/Button';\nimport IntlMessages from '../../../../util/IntlMessages';\nimport { connect } from 'react-redux';\nimport 'react-confirm-alert/src/react-confirm-alert.css';\nimport _ from 'lodash';\nimport { UncontrolledAlert } from 'reactstrap';\nimport { isObject, isString } from 'formik';\nlet timeout;\n\nclass StudentList extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      countAbsent: 0,\n      countPresent: 0,\n      modal: false,\n      list: [],\n      refresh: 0,\n      alertNoChange: false,\n      changeHappened: false\n    };\n    this.handleRequestSave = this.handleRequestSave.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n    this.handleChangeList = this.handleChangeList.bind(this);\n    this.handleCloseAlert = this.handleCloseAlert.bind(this);\n  }\n\n  handleCloseAlert() {\n    timeout = setTimeout(() => this.setState({\n      alertNoChange: false\n    }), 3000);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.prevStudentStatus !== this.props.prevStudentStatus || prevProps.gEvent.listContextual !== this.props.gEvent.listContextual) {\n      this.handleChangeList(this.props.prevStudentStatus);\n    }\n  }\n\n  componentWillUnmount() {\n    clearTimeout(timeout);\n    this.setState({\n      countAbsent: 0,\n      countPresent: 0,\n      modal: false,\n      list: [],\n      refresh: 0,\n      alertNoChange: false,\n      changeHappened: false\n    });\n  }\n\n  handleChange(item) {\n    let filterList = [];\n    filterList = this.state.list.filter(data => data.profile_student_id !== parseInt(item.id));\n    let actionOfItem = actionDetails(item);\n    this.setState({\n      changeHappened: true,\n      alertNoChange: false,\n      list: [...filterList, {\n        action: actionOfItem,\n        profile_student_id: parseInt(item.id)\n      }]\n    });\n  }\n\n  handleChangeList(list) {\n    // Used to initalize all the list\n    this.setState({\n      list: [...list],\n      changeHappened: false\n    });\n  }\n\n  handleRequestSave(e) {\n    e.preventDefault();\n    let countPresent = 0;\n    let countAbsent = 0;\n    let result = [];\n    console.log(this.props.prevStudentStatus);\n\n    if (this.state.list.length !== 0 && this.state.changeHappened && this.props.prevStudentStatus.length !== 0) {\n      result = this.props.prevStudentStatus.map(obj => {\n        let element;\n        let findElement = this.state.list.find(call => call.profile_student_id === obj.profile_student_id);\n\n        if (!_.isEmpty(findElement)) {\n          findElement.action === \"Absent\" && findElement.action !== \"Puni\" && findElement.action !== \"En Retard\" && findElement.action !== \"En Retard et Puni\" ? countAbsent += 1 : countPresent += 1;\n          element = {\n            action: findElement.action,\n            profile_student_id: findElement.profile_student_id\n          };\n        } else {\n          obj.action === \"Absent\" && obj.action !== \"Puni\" && obj.action !== \"En Retard\" && obj.action !== \"En Retard et Puni\" ? countAbsent += 1 : countPresent += 1;\n          element = {\n            action: obj.action,\n            profile_student_id: obj.profile_student_id\n          };\n        }\n\n        return element;\n      });\n    } else if (this.state.list.length !== 0 && this.state.changeHappened && this.props.firstTry) {\n      result = this.props.users.map(obj => {\n        let element;\n        let findElement = this.state.list.find(call => call.profile_student_id === obj.id);\n\n        if (!_.isEmpty(findElement)) {\n          findElement.action === \"Absent\" && findElement.action !== \"Puni\" && findElement.action !== \"En Retard\" && findElement.action !== \"En Retard et Puni\" ? countAbsent += 1 : countPresent += 1;\n          element = {\n            action: findElement.action,\n            profile_student_id: findElement.profile_student_id\n          };\n        } else {\n          countPresent += 1;\n          element = {\n            action: \"Present\",\n            profile_student_id: obj.id\n          };\n        }\n\n        return element;\n      });\n    } else if (!this.state.changeHappened && this.props.firstTry) {\n      let element;\n      result = this.props.users.map(obj => {\n        countPresent += 1;\n        element = {\n          action: \"Present\",\n          profile_student_id: obj.id\n        };\n        return element;\n      });\n      this.setState({\n        alertNoChange: true\n      });\n    } else if (this.props.prevStudentStatus.length !== 0 && !this.state.changeHappened) {\n      this.setState({\n        alertNoChange: true\n      });\n    }\n\n    if (this.state.changeHappened || this.props.firstTry) {\n      this.props.NumberAbsentPresent(countPresent, countAbsent);\n      this.props.RequestSaveRegister(result);\n      this.setState({\n        countPresent: 0,\n        countAbsent: 0,\n        modal: false\n      });\n    }\n\n    this.handleCloseAlert();\n  }\n\n  render() {\n    if (this.props.users && this.props.firstTry) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"app-wrapper\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 17\n        }\n      }, this.state.alertNoChange ? /*#__PURE__*/React.createElement(UncontrolledAlert, {\n        color: \"info\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 49\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 25\n        }\n      }, \" \", /*#__PURE__*/React.createElement(IntlMessages, {\n        id: \"message.alert.call.undone\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 34\n        }\n      }), \" \")) : '', /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-12\",\n        style: {\n          display: \"flex\",\n          flexWrap: \"wrap\",\n          margin: \"auto\"\n        },\n        autoComplete: \"off\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 21\n        }\n      }, this.props.users.map((data, index) => /*#__PURE__*/React.createElement(StudentItem, {\n        status: {\n          checkPresent: true,\n          checkRetard: false,\n          checkPunition: false\n        },\n        key: index,\n        id: data.id,\n        data: data,\n        handleChange: this.handleChange,\n        styleName: \"card shadow\",\n        establishment_id: data.establishment_id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 29\n        }\n      }))), /*#__PURE__*/React.createElement(Button, {\n        variant: \"contained\",\n        color: \"primary\",\n        className: \"jr-btn text-white\",\n        style: {\n          position: \"relative\",\n          float: 'right',\n          marginBottom: 10 + 'px'\n        },\n        onClick: this.handleRequestSave,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(IntlMessages, {\n        id: \"button.save.registreAppel\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 22\n        }\n      })));\n    } else if (this.props.users && !this.props.firstTry && this.props.prevStudentStatus) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"app-wrapper\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 17\n        }\n      }, this.state.alertNoChange ? /*#__PURE__*/React.createElement(UncontrolledAlert, {\n        color: \"danger\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 49\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 25\n        }\n      }, \" \", /*#__PURE__*/React.createElement(IntlMessages, {\n        id: \"message.alert.same.call\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 34\n        }\n      }), \" \")) : '', /*#__PURE__*/React.createElement(\"div\", {\n        className: \"col-md-12\",\n        style: {\n          display: \"flex\",\n          flexWrap: \"wrap\",\n          margin: \"auto\"\n        },\n        autoComplete: \"off\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 21\n        }\n      }, this.props.users.map((data, index) => /*#__PURE__*/React.createElement(StudentItem, {\n        prevStudentStatus: this.props.prevStudentStatus,\n        key: data.id,\n        id: data.id,\n        data: data,\n        handleChange: this.handleChange,\n        handleChangeList: this.handleChangeList,\n        styleName: \"card shadow\",\n        establishment_id: data.establishment_id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 29\n        }\n      }))), /*#__PURE__*/React.createElement(Button, {\n        variant: \"contained\",\n        color: \"primary\",\n        className: \"jr-btn text-white\",\n        style: {\n          position: \"relative\",\n          float: 'right',\n          marginBottom: 10 + 'px'\n        },\n        onClick: this.handleRequestSave,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(IntlMessages, {\n        id: \"button.save.registreAppel\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 22\n        }\n      })));\n    } else {\n      return \"\";\n    }\n  }\n\n}\n\nfunction actionDetails(obj) {\n  let present = obj.checkPresent;\n  let retard = obj.checkRetard;\n  let punition = obj.checkPunition;\n\n  if (present && retard && punition) {\n    return \"En Retard et Puni\";\n  } else if (present && retard) {\n    return \"En Retard\";\n  } else if (present && punition) {\n    return \"Puni\";\n  } else if (!present) {\n    return \"Absent\";\n  } else if (present) {\n    return \"Present\";\n  }\n}\n\nexport default connect()(StudentList);","map":{"version":3,"sources":["/home/oem/Documents/projects/educap/classebook-front-web/src/app/routes/RegistreAppel/StudentList/StudentList.js"],"names":["React","Component","StudentItem","Button","IntlMessages","connect","_","UncontrolledAlert","isObject","isString","timeout","StudentList","constructor","props","state","countAbsent","countPresent","modal","list","refresh","alertNoChange","changeHappened","handleRequestSave","bind","handleChange","handleChangeList","handleCloseAlert","setTimeout","setState","componentDidUpdate","prevProps","prevStudentStatus","gEvent","listContextual","componentWillUnmount","clearTimeout","item","filterList","filter","data","profile_student_id","parseInt","id","actionOfItem","actionDetails","action","e","preventDefault","result","console","log","length","map","obj","element","findElement","find","call","isEmpty","firstTry","users","NumberAbsentPresent","RequestSaveRegister","render","display","flexWrap","margin","index","checkPresent","checkRetard","checkPunition","establishment_id","position","float","marginBottom","present","retard","punition"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport StudentItem from './StudentItem';\nimport Button from '@material-ui/core/Button';\nimport IntlMessages from '../../../../util/IntlMessages';\nimport { connect } from 'react-redux';\nimport 'react-confirm-alert/src/react-confirm-alert.css'\nimport _ from 'lodash';\nimport { UncontrolledAlert } from 'reactstrap';\nimport { isObject, isString } from 'formik';\n\nlet timeout;\n\n\nclass StudentList extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            countAbsent: 0,\n            countPresent: 0,\n            modal: false,\n            list: [],\n            refresh: 0,\n            alertNoChange: false,\n            changeHappened: false\n        }\n        this.handleRequestSave = this.handleRequestSave.bind(this);\n        this.handleChange = this.handleChange.bind(this);\n        this.handleChangeList = this.handleChangeList.bind(this);\n        this.handleCloseAlert = this.handleCloseAlert.bind(this);\n    }\n\n    handleCloseAlert() {\n        timeout = setTimeout(() => this.setState({ alertNoChange: false }), 3000)\n    }\n\n    componentDidUpdate(prevProps) {\n        if (prevProps.prevStudentStatus !== this.props.prevStudentStatus || prevProps.gEvent.listContextual !== this.props.gEvent.listContextual) {\n            this.handleChangeList(this.props.prevStudentStatus)\n        }\n    }\n    componentWillUnmount() {\n        clearTimeout(timeout);\n        this.setState({\n            countAbsent: 0,\n            countPresent: 0,\n            modal: false,\n            list: [],\n            refresh: 0,\n            alertNoChange: false,\n            changeHappened: false\n        })\n    }\n\n    handleChange(item) {\n        let filterList = [];\n        filterList = this.state.list.filter(data => (data.profile_student_id !== parseInt(item.id)))\n\n        let actionOfItem = actionDetails(item);\n        this.setState({\n            changeHappened: true, alertNoChange: false,\n            list: [...filterList, { action: actionOfItem, profile_student_id: parseInt(item.id) }]\n        });\n    }\n\n    handleChangeList(list) {\n        // Used to initalize all the list\n\n        this.setState({\n            list: [...list], changeHappened: false\n        });\n    }\n\n    handleRequestSave(e) {\n        e.preventDefault();\n        let countPresent = 0;\n        let countAbsent = 0;\n\n        let result = [];\n        console.log(this.props.prevStudentStatus)\n\n        if (this.state.list.length !== 0 && this.state.changeHappened && this.props.prevStudentStatus.length !== 0) {\n\n            result = this.props.prevStudentStatus.map(obj => {\n                let element;\n                let findElement = this.state.list.find(call => call.profile_student_id === obj.profile_student_id)\n                if (!_.isEmpty(findElement)) {\n                    (findElement.action === \"Absent\" && findElement.action !== \"Puni\" && findElement.action !== \"En Retard\" && findElement.action !== \"En Retard et Puni\") ?\n                        countAbsent += 1 : countPresent += 1;\n                    element = ({ action: findElement.action, profile_student_id: findElement.profile_student_id })\n                } else {\n                    (obj.action === \"Absent\" && obj.action !== \"Puni\" && obj.action !== \"En Retard\" && obj.action !== \"En Retard et Puni\") ?\n                        countAbsent += 1 : countPresent += 1;\n                    element = ({ action: obj.action, profile_student_id: obj.profile_student_id })\n                }\n                return element\n            })\n        } else if (this.state.list.length !== 0 && this.state.changeHappened && this.props.firstTry) {\n            result = this.props.users.map(obj => {\n                let element;\n                let findElement = this.state.list.find(call => call.profile_student_id === obj.id)\n                if (!_.isEmpty(findElement)) {\n                    (findElement.action === \"Absent\" && findElement.action !== \"Puni\" && findElement.action !== \"En Retard\" && findElement.action !== \"En Retard et Puni\") ?\n                        countAbsent += 1 : countPresent += 1;\n                    element = ({ action: findElement.action, profile_student_id: findElement.profile_student_id })\n\n                } else {\n                    countPresent += 1;\n                    element = ({ action: \"Present\", profile_student_id: obj.id })\n\n                }\n                return element\n            })\n        }\n        else if (!(this.state.changeHappened) && this.props.firstTry) {\n            let element;\n            result = this.props.users.map(obj => {\n                countPresent += 1;\n                element = ({ action: \"Present\", profile_student_id: obj.id })\n\n                return element\n            })\n            this.setState({ alertNoChange: true });\n        } else if (this.props.prevStudentStatus.length !== 0 && !(this.state.changeHappened)) {\n            this.setState({ alertNoChange: true });\n        }\n      \n       \n         if (this.state.changeHappened || this.props.firstTry) {\n            this.props.NumberAbsentPresent(countPresent, countAbsent)\n            this.props.RequestSaveRegister(result)\n            this.setState({ countPresent: 0, countAbsent: 0, modal: false });\n        }\n        this.handleCloseAlert();\n    }\n\n    render() {\n \n        if (this.props.users && this.props.firstTry) {\n            return (\n                <div className=\"app-wrapper\">\n                    {this.state.alertNoChange ? <UncontrolledAlert color=\"info\"  >\n                        <span > {<IntlMessages id=\"message.alert.call.undone\" />} </span>\n                    </UncontrolledAlert> : ''}\n                    <div className=\"col-md-12\" style={{display:\"flex\",flexWrap: \"wrap\",margin:\"auto\"}}  autoComplete=\"off\">\n\n                        {this.props.users.map((data, index) => (\n                            <StudentItem\n                                status={{ checkPresent: true, checkRetard: false, checkPunition: false }}\n                                key={index}\n                                id={data.id}\n                                data={data}\n                                handleChange={this.handleChange}\n                                styleName=\"card shadow\"\n                                establishment_id={data.establishment_id}\n                            />\n                        ))}\n                    </div>\n                    <Button variant=\"contained\" color=\"primary\" className=\"jr-btn text-white\" style={{ position: \"relative\", float: 'right', marginBottom: 10 + 'px' }}\n                        onClick={this.handleRequestSave}\n                    ><IntlMessages id=\"button.save.registreAppel\" /></Button>\n                </div>\n            )\n        } else if (this.props.users && !(this.props.firstTry) && this.props.prevStudentStatus) {\n            return (\n                <div className=\"app-wrapper\">\n                    {this.state.alertNoChange ? <UncontrolledAlert color=\"danger\" >\n                        <span > {<IntlMessages id=\"message.alert.same.call\" />} </span>\n                    </UncontrolledAlert> : ''}\n                    <div className=\"col-md-12\" style={{display:\"flex\",flexWrap: \"wrap\",margin:\"auto\"}} autoComplete=\"off\">\n\n                        {this.props.users.map((data, index) => (\n                            <StudentItem\n                                prevStudentStatus={this.props.prevStudentStatus}\n                                key={data.id}\n                                id={data.id}\n                                data={data}\n                                handleChange={this.handleChange}\n                                handleChangeList={this.handleChangeList}\n                                styleName=\"card shadow\"\n                                establishment_id={data.establishment_id}\n                            />\n                        ))}\n                    </div>\n                    <Button variant=\"contained\" color=\"primary\" className=\"jr-btn text-white\" style={{ position: \"relative\", float: 'right', marginBottom: 10 + 'px' }}\n                        onClick={this.handleRequestSave}\n                    ><IntlMessages id=\"button.save.registreAppel\" /></Button>\n                </div>\n            )\n        } else { return \"\" }\n    }\n}\n\nfunction actionDetails(obj) {\n    let present = obj.checkPresent\n    let retard = obj.checkRetard\n    let punition = obj.checkPunition\n    if (present && retard && punition) { return \"En Retard et Puni\" }\n    else if (present && retard) { return \"En Retard\" }\n    else if (present && punition) { return \"Puni\" }\n    else if (!present) { return \"Absent\" }\n    else if (present) { return \"Present\" }\n}\n\nexport default connect()(StudentList); "]},"metadata":{},"sourceType":"module"}