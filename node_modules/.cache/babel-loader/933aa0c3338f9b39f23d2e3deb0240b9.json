{"ast":null,"code":"import axios from \"axios\";\nimport { HIDE_MESSAGE, INIT_URL, ON_HIDE_LOADER, ON_SHOW_LOADER, SHOW_MESSAGE, SIGNIN_FACEBOOK_USER, SIGNIN_FACEBOOK_USER_SUCCESS, SIGNIN_GITHUB_USER, SIGNIN_GITHUB_USER_SUCCESS, SIGNIN_GOOGLE_USER, SIGNIN_GOOGLE_USER_SUCCESS, SIGNIN_TWITTER_USER, SIGNIN_TWITTER_USER_SUCCESS, SIGNIN_USER_SUCCESS, SIGNOUT_USER, SIGNOUT_USER_SUCCESS, SIGNUP_USER, SIGNUP_USER_SUCCESS, GET_USER_PROFILE, THEME_COLOR } from \"../constants/ActionTypes\";\nimport cst from \"../config/config\";\nimport { getError } from \"../Error/Error\";\nimport { getThemeColor, getAppLanguage, initCalendar } from \"./Setting\";\nexport const userSignUp = user => {\n  return {\n    type: SIGNUP_USER,\n    payload: user\n  };\n};\nexport const userSignIn = user => {\n  var email = user.email.toLowerCase().trim();\n  var password = user.password;\n  const User = {\n    email,\n    password\n  };\n  return dispatch => {\n    axios.post(`${cst.baseUrl}/users/login`, User).then(res => {\n      let userID = res.data.userId;\n      let id = res.data.id;\n      localStorage.setItem(\"token\", res.data.id);\n      localStorage.setItem(\"user_id\", res.data.userId);\n      axios.get(`${cst.baseUrl}/users/${res.data.userId}?access_token=${res.data.id}&filter[include][profiles]`).then(res => {\n        let settingId = res.data.profiles[0].setting_id;\n        axios.get(`${cst.baseUrl}/settings/${settingId}?access_token=${localStorage.token}`).then(res => {\n          dispatch(getThemeColor(res.data.theme_color));\n          dispatch(getAppLanguage(res.data.app_lang));\n          dispatch(initCalendar(res.data.start_time_calendar, res.data.end_time_calendar));\n          localStorage.setItem(\"appLang\", res.data.app_lang);\n        });\n      }).catch(err => {\n        console.log(err);\n      });\n      dispatch(getEstablishmentsModules(id));\n      getprofile(localStorage.user_id);\n      return axios.get(`${cst.baseUrl}/users/${res.data.userId}?access_token=${res.data.id}`);\n    }).then(res => {\n      localStorage.setItem(\"first_connexion\", JSON.stringify(res.data.first_connexion));\n      localStorage.setItem(\"user\", JSON.stringify(res.data));\n      dispatch(getUserProfile(res.data.id));\n      return dispatch({\n        type: SIGNIN_USER_SUCCESS,\n        payload: User\n      });\n    }).catch(err => dispatch(showAuthMessage(\"Veuillez vÃ©rifier votre login et mot de passe\")));\n  };\n};\nexport const getEstablishmentsModules = id => {\n  return function (dispatch) {\n    axios.get(`${cst.baseUrl}/profiles/fetchModuleByUserID/` + localStorage.user_id + `?access_token=${localStorage.token}`).then(res => {\n      dispatch({\n        type: \"GET_ESTABLISHMENT_MODULE\",\n        payload: res.data\n      });\n    }).catch(error => {\n      console.log(error);\n    });\n  };\n};\nexport const resetAccountPassword = data => {\n  return function (dispatch) {\n    var token = localStorage.getItem(\"token\");\n    axios.post(`${cst.baseUrl}/users/reset-initial-password?access_token=${token}`, data, {\n      headers: {\n        \"content-type\": \"application/json\"\n      }\n    }).then(res => {}).catch(error => {\n      console.log(error);\n    });\n  };\n};\nexport function getUserProfile(userId) {\n  return function (dispatch) {\n    axios.get(`${cst.baseUrl}/profiles/findOne?access_token=${localStorage.token}&filter={\"where\":{\"user_id\":` + userId + `}}`).then(res => {\n      dispatch({\n        type: GET_USER_PROFILE,\n        payload: res.data\n      });\n      axios.get(`${cst.baseUrl}/settings/${res.data.setting_id}?access_token=${localStorage.token}`).then(res => {\n        dispatch(getThemeColor(res.data.theme_color));\n        dispatch(getAppLanguage(res.data.app_lang));\n        dispatch(initCalendar(res.data.start_time_calendar, res.data.end_time_calendar));\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n}\n\nfunction getprofile(userId, dispatch) {\n  axios.get(`${cst.baseUrl}/profiles/findOne?access_token=${localStorage.token}&filter={\"where\":{\"user_id\":` + userId + `}}`).then(res => {\n    const profiles = res.data;\n    localStorage.setItem(\"profileId\", profiles.id);\n    localStorage.setItem(\"roles_id\", profiles.role_id);\n    localStorage.setItem(\"establishment_id\", profiles.establishment_id);\n  }).catch(err => {\n    if (err.response.status === 401) {\n      dispatch(userSignOut());\n    }\n  });\n}\n\nexport const userSignOut = () => {\n  axios.post(`${cst.baseUrl}/users/logout?access_token=${localStorage.token}`);\n  localStorage.removeItem(\"token\");\n  localStorage.removeItem(\"profileId\");\n  localStorage.removeItem(\"roles_id\");\n  localStorage.removeItem(\"user_id\");\n  localStorage.removeItem(\"establishment_id\");\n  return {\n    type: SIGNOUT_USER\n  };\n};\nexport const userSignUpSuccess = authUser => {\n  return {\n    type: SIGNUP_USER_SUCCESS,\n    payload: authUser\n  };\n};\nexport const userSignInSuccess = authUser => {\n  return {\n    type: SIGNIN_USER_SUCCESS,\n    payload: authUser\n  };\n};\nexport const userSignOutSuccess = () => {\n  return {\n    type: SIGNOUT_USER_SUCCESS\n  };\n};\nexport const showAuthMessage = message => {\n  return {\n    type: SHOW_MESSAGE,\n    payload: message\n  };\n};\nexport const userGoogleSignIn = () => {\n  return {\n    type: SIGNIN_GOOGLE_USER\n  };\n};\nexport const userGoogleSignInSuccess = authUser => {\n  return {\n    type: SIGNIN_GOOGLE_USER_SUCCESS,\n    payload: authUser\n  };\n};\nexport const userFacebookSignIn = () => {\n  return {\n    type: SIGNIN_FACEBOOK_USER\n  };\n};\nexport const userFacebookSignInSuccess = authUser => {\n  return {\n    type: SIGNIN_FACEBOOK_USER_SUCCESS,\n    payload: authUser\n  };\n};\nexport const setInitUrl = url => {\n  return {\n    type: INIT_URL,\n    payload: url\n  };\n};\nexport const userTwitterSignIn = () => {\n  return {\n    type: SIGNIN_TWITTER_USER\n  };\n};\nexport const userTwitterSignInSuccess = authUser => {\n  return {\n    type: SIGNIN_TWITTER_USER_SUCCESS,\n    payload: authUser\n  };\n};\nexport const userGithubSignIn = () => {\n  return {\n    type: SIGNIN_GITHUB_USER\n  };\n};\nexport const userGithubSignInSuccess = authUser => {\n  return {\n    type: SIGNIN_GITHUB_USER_SUCCESS,\n    payload: authUser\n  };\n};\nexport const showAuthLoader = () => {\n  return {\n    type: ON_SHOW_LOADER\n  };\n};\nexport const hideMessage = () => {\n  return {\n    type: HIDE_MESSAGE\n  };\n};\nexport const hideAuthLoader = () => {\n  return {\n    type: ON_HIDE_LOADER\n  };\n};","map":{"version":3,"sources":["/home/oem/Documents/projects/educap/classebook-front-web/src/actions/Auth.js"],"names":["axios","HIDE_MESSAGE","INIT_URL","ON_HIDE_LOADER","ON_SHOW_LOADER","SHOW_MESSAGE","SIGNIN_FACEBOOK_USER","SIGNIN_FACEBOOK_USER_SUCCESS","SIGNIN_GITHUB_USER","SIGNIN_GITHUB_USER_SUCCESS","SIGNIN_GOOGLE_USER","SIGNIN_GOOGLE_USER_SUCCESS","SIGNIN_TWITTER_USER","SIGNIN_TWITTER_USER_SUCCESS","SIGNIN_USER_SUCCESS","SIGNOUT_USER","SIGNOUT_USER_SUCCESS","SIGNUP_USER","SIGNUP_USER_SUCCESS","GET_USER_PROFILE","THEME_COLOR","cst","getError","getThemeColor","getAppLanguage","initCalendar","userSignUp","user","type","payload","userSignIn","email","toLowerCase","trim","password","User","dispatch","post","baseUrl","then","res","userID","data","userId","id","localStorage","setItem","get","settingId","profiles","setting_id","token","theme_color","app_lang","start_time_calendar","end_time_calendar","catch","err","console","log","getEstablishmentsModules","getprofile","user_id","JSON","stringify","first_connexion","getUserProfile","showAuthMessage","error","resetAccountPassword","getItem","headers","role_id","establishment_id","response","status","userSignOut","removeItem","userSignUpSuccess","authUser","userSignInSuccess","userSignOutSuccess","message","userGoogleSignIn","userGoogleSignInSuccess","userFacebookSignIn","userFacebookSignInSuccess","setInitUrl","url","userTwitterSignIn","userTwitterSignInSuccess","userGithubSignIn","userGithubSignInSuccess","showAuthLoader","hideMessage","hideAuthLoader"],"mappings":"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","sourcesContent":["import axios from \"axios\";\r\nimport {\r\n  HIDE_MESSAGE,\r\n  INIT_URL,\r\n  ON_HIDE_LOADER,\r\n  ON_SHOW_LOADER,\r\n  SHOW_MESSAGE,\r\n  SIGNIN_FACEBOOK_USER,\r\n  SIGNIN_FACEBOOK_USER_SUCCESS,\r\n  SIGNIN_GITHUB_USER,\r\n  SIGNIN_GITHUB_USER_SUCCESS,\r\n  SIGNIN_GOOGLE_USER,\r\n  SIGNIN_GOOGLE_USER_SUCCESS,\r\n  SIGNIN_TWITTER_USER,\r\n  SIGNIN_TWITTER_USER_SUCCESS,\r\n  SIGNIN_USER_SUCCESS,\r\n  SIGNOUT_USER,\r\n  SIGNOUT_USER_SUCCESS,\r\n  SIGNUP_USER,\r\n  SIGNUP_USER_SUCCESS,\r\n  GET_USER_PROFILE,\r\n  THEME_COLOR,\r\n} from \"../constants/ActionTypes\";\r\nimport cst from \"../config/config\";\r\nimport { getError } from \"../Error/Error\";\r\nimport { getThemeColor, getAppLanguage, initCalendar } from \"./Setting\";\r\n\r\nexport const userSignUp = (user) => {\r\n  return {\r\n    type: SIGNUP_USER,\r\n    payload: user,\r\n  };\r\n};\r\n\r\nexport const userSignIn = (user) => {\r\n  var email = user.email.toLowerCase().trim();\r\n  var password = user.password;\r\n  const User = { email, password };\r\n  return (dispatch) => {\r\n    axios\r\n      .post(`${cst.baseUrl}/users/login`, User)\r\n      .then((res) => {\r\n        let userID = res.data.userId;\r\n        let id = res.data.id;\r\n        localStorage.setItem(\"token\", res.data.id);\r\n        localStorage.setItem(\"user_id\", res.data.userId);\r\n        axios\r\n          .get(\r\n            `${cst.baseUrl}/users/${res.data.userId}?access_token=${res.data.id}&filter[include][profiles]`\r\n          )\r\n          .then((res) => {\r\n            let settingId = res.data.profiles[0].setting_id;\r\n            axios\r\n              .get(\r\n                `${cst.baseUrl}/settings/${settingId}?access_token=${localStorage.token}`\r\n              )\r\n              .then((res) => {\r\n                dispatch(getThemeColor(res.data.theme_color));\r\n                dispatch(getAppLanguage(res.data.app_lang));\r\n                dispatch(\r\n                  initCalendar(\r\n                    res.data.start_time_calendar,\r\n                    res.data.end_time_calendar\r\n                  )\r\n                );\r\n                localStorage.setItem(\"appLang\", res.data.app_lang);\r\n              });\r\n          })\r\n          .catch((err) => {\r\n            console.log(err);\r\n          });\r\n\r\n        dispatch(getEstablishmentsModules(id));\r\n        getprofile(localStorage.user_id);\r\n        return axios.get(\r\n          `${cst.baseUrl}/users/${res.data.userId}?access_token=${res.data.id}`\r\n        );\r\n      })\r\n      .then((res) => {\r\n        localStorage.setItem(\r\n          \"first_connexion\",\r\n          JSON.stringify(res.data.first_connexion)\r\n        );\r\n        localStorage.setItem(\"user\", JSON.stringify(res.data));\r\n        dispatch(getUserProfile(res.data.id));\r\n        return dispatch({\r\n          type: SIGNIN_USER_SUCCESS,\r\n          payload: User,\r\n        });\r\n      })\r\n      .catch((err) =>\r\n        dispatch(\r\n          showAuthMessage(\"Veuillez vÃ©rifier votre login et mot de passe\")\r\n        )\r\n      );\r\n  };\r\n};\r\n\r\nexport const getEstablishmentsModules = (id) => {\r\n  return function(dispatch) {\r\n    axios\r\n      .get(\r\n        `${cst.baseUrl}/profiles/fetchModuleByUserID/` +\r\n          localStorage.user_id +\r\n          `?access_token=${localStorage.token}`\r\n      )\r\n      .then((res) => {\r\n        dispatch({ type: \"GET_ESTABLISHMENT_MODULE\", payload: res.data });\r\n      })\r\n      .catch((error) => {\r\n        console.log(error);\r\n      });\r\n  };\r\n};\r\n\r\nexport const resetAccountPassword = (data) => {\r\n  return function(dispatch) {\r\n    var token = localStorage.getItem(\"token\");\r\n    axios\r\n      .post(\r\n        `${cst.baseUrl}/users/reset-initial-password?access_token=${token}`,\r\n        data,\r\n        {\r\n          headers: {\r\n            \"content-type\": \"application/json\",\r\n          },\r\n        }\r\n      )\r\n      .then((res) => {})\r\n      .catch((error) => {\r\n        console.log(error);\r\n      });\r\n  };\r\n};\r\n\r\nexport function getUserProfile(userId) {\r\n  return function(dispatch) {\r\n    axios\r\n      .get(\r\n        `${cst.baseUrl}/profiles/findOne?access_token=${localStorage.token}&filter={\"where\":{\"user_id\":` +\r\n          userId +\r\n          `}}`\r\n      )\r\n      .then((res) => {\r\n        dispatch({ type: GET_USER_PROFILE, payload: res.data });\r\n        axios\r\n          .get(\r\n            `${cst.baseUrl}/settings/${res.data.setting_id}?access_token=${localStorage.token}`\r\n          )\r\n          .then((res) => {\r\n            dispatch(getThemeColor(res.data.theme_color));\r\n            dispatch(getAppLanguage(res.data.app_lang));\r\n            dispatch(\r\n              initCalendar(\r\n                res.data.start_time_calendar,\r\n                res.data.end_time_calendar\r\n              )\r\n            );\r\n          });\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n  };\r\n}\r\n\r\nfunction getprofile(userId, dispatch) {\r\n  axios\r\n    .get(\r\n      `${cst.baseUrl}/profiles/findOne?access_token=${localStorage.token}&filter={\"where\":{\"user_id\":` +\r\n        userId +\r\n        `}}`\r\n    )\r\n    .then((res) => {\r\n      const profiles = res.data;\r\n      localStorage.setItem(\"profileId\", profiles.id);\r\n      localStorage.setItem(\"roles_id\", profiles.role_id);\r\n      localStorage.setItem(\"establishment_id\", profiles.establishment_id);\r\n    })\r\n    .catch((err) => {\r\n      if (err.response.status === 401) {\r\n        dispatch(userSignOut());\r\n      }\r\n    });\r\n}\r\n\r\nexport const userSignOut = () => {\r\n  axios.post(`${cst.baseUrl}/users/logout?access_token=${localStorage.token}`);\r\n  localStorage.removeItem(\"token\");\r\n  localStorage.removeItem(\"profileId\");\r\n  localStorage.removeItem(\"roles_id\");\r\n  localStorage.removeItem(\"user_id\");\r\n  localStorage.removeItem(\"establishment_id\");\r\n\r\n  return {\r\n    type: SIGNOUT_USER,\r\n  };\r\n};\r\n\r\nexport const userSignUpSuccess = (authUser) => {\r\n  return {\r\n    type: SIGNUP_USER_SUCCESS,\r\n    payload: authUser,\r\n  };\r\n};\r\n\r\nexport const userSignInSuccess = (authUser) => {\r\n  return {\r\n    type: SIGNIN_USER_SUCCESS,\r\n    payload: authUser,\r\n  };\r\n};\r\nexport const userSignOutSuccess = () => {\r\n  return {\r\n    type: SIGNOUT_USER_SUCCESS,\r\n  };\r\n};\r\n\r\nexport const showAuthMessage = (message) => {\r\n  return {\r\n    type: SHOW_MESSAGE,\r\n    payload: message,\r\n  };\r\n};\r\n\r\nexport const userGoogleSignIn = () => {\r\n  return {\r\n    type: SIGNIN_GOOGLE_USER,\r\n  };\r\n};\r\nexport const userGoogleSignInSuccess = (authUser) => {\r\n  return {\r\n    type: SIGNIN_GOOGLE_USER_SUCCESS,\r\n    payload: authUser,\r\n  };\r\n};\r\nexport const userFacebookSignIn = () => {\r\n  return {\r\n    type: SIGNIN_FACEBOOK_USER,\r\n  };\r\n};\r\nexport const userFacebookSignInSuccess = (authUser) => {\r\n  return {\r\n    type: SIGNIN_FACEBOOK_USER_SUCCESS,\r\n    payload: authUser,\r\n  };\r\n};\r\nexport const setInitUrl = (url) => {\r\n  return {\r\n    type: INIT_URL,\r\n    payload: url,\r\n  };\r\n};\r\nexport const userTwitterSignIn = () => {\r\n  return {\r\n    type: SIGNIN_TWITTER_USER,\r\n  };\r\n};\r\nexport const userTwitterSignInSuccess = (authUser) => {\r\n  return {\r\n    type: SIGNIN_TWITTER_USER_SUCCESS,\r\n    payload: authUser,\r\n  };\r\n};\r\nexport const userGithubSignIn = () => {\r\n  return {\r\n    type: SIGNIN_GITHUB_USER,\r\n  };\r\n};\r\nexport const userGithubSignInSuccess = (authUser) => {\r\n  return {\r\n    type: SIGNIN_GITHUB_USER_SUCCESS,\r\n    payload: authUser,\r\n  };\r\n};\r\nexport const showAuthLoader = () => {\r\n  return {\r\n    type: ON_SHOW_LOADER,\r\n  };\r\n};\r\n\r\nexport const hideMessage = () => {\r\n  return {\r\n    type: HIDE_MESSAGE,\r\n  };\r\n};\r\nexport const hideAuthLoader = () => {\r\n  return {\r\n    type: ON_HIDE_LOADER,\r\n  };\r\n};\r\n"]},"metadata":{},"sourceType":"module"}