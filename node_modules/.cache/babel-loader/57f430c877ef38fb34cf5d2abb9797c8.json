{"ast":null,"code":"import axios from \"axios\";\nimport { HIDE_MESSAGE, INIT_URL, ON_HIDE_LOADER, ON_SHOW_LOADER, SHOW_MESSAGE, SIGNIN_FACEBOOK_USER, SIGNIN_FACEBOOK_USER_SUCCESS, SIGNIN_GITHUB_USER, SIGNIN_GITHUB_USER_SUCCESS, SIGNIN_GOOGLE_USER, SIGNIN_GOOGLE_USER_SUCCESS, SIGNIN_TWITTER_USER, SIGNIN_TWITTER_USER_SUCCESS, SIGNIN_USER_SUCCESS, SIGNOUT_USER, SIGNOUT_USER_SUCCESS, SIGNUP_USER, SIGNUP_USER_SUCCESS, GET_USER_PROFILE, THEME_COLOR, FETECHED_ALL_SCHOOL_YEAR_ETAB } from \"../constants/ActionTypes\";\nimport cst from \"../config/config\";\nimport { getError } from \"../Error/Error\";\nimport { getThemeColor, getAppLanguage, initCalendar } from \"./Setting\";\nexport const userSignUp = user => {\n  return {\n    type: SIGNUP_USER,\n    payload: user\n  };\n};\nexport const userSignIn = user => {\n  var email = user.email.toLowerCase().trim();\n  var password = user.password;\n  const User = {\n    email,\n    password\n  };\n  return dispatch => {\n    axios.post(`${cst.baseUrl}/users/login`, User).then(res => {\n      // let id = res.data.id;\n      localStorage.setItem(\"token\", res.data.id);\n      localStorage.setItem(\"user_id\", res.data.userId);\n      dispatch(getProfile(res.data.userId));\n    }).catch(err => dispatch(showAuthMessage(\"Veuillez vérifier votre login et mot de passe\")));\n  };\n};\nexport const getProfile = userId => {\n  let user = {};\n  return function (dispatch) {\n    var token = localStorage.getItem(\"token\");\n    axios.get(`${cst.baseUrl}/profiles/getprofile/${userId}?access_token=${token}&filter[include]=user&filter[include]=setting&filter[include]=establishments`).then(res => {\n      let result = res.data.profile[0];\n      user = result.user;\n      dispatch(getThemeColor(result.setting.theme_color));\n      dispatch(getAppLanguage(result.setting.app_lang));\n      dispatch(initCalendar(result.setting.start_time_calendar, result.setting.end_time_calendar));\n      localStorage.setItem(\"profileId\", result.id);\n      localStorage.setItem(\"roles_id\", result.role_id);\n      localStorage.setItem(\"appLang\", result.app_lang);\n      localStorage.setItem(\"first_connexion\", JSON.stringify(result.user.first_connexion));\n      localStorage.setItem(\"user\", JSON.stringify(result.user));\n      dispatch(userSignInSuccess(result.user));\n\n      if (result.establishments.length > 1) {\n        dispatch({\n          type: \"SOW_MODAL_SELECT_ESTABLISHMENT\",\n          payload: result\n        });\n      } else {\n        const userProfile = Object.assign({}, result, {\n          establishment_id: result.establishments[0].establishment_id\n        });\n        dispatch({\n          type: GET_USER_PROFILE,\n          payload: userProfile\n        });\n        localStorage.setItem(\"establishment_id\", result.establishments[0].establishment_id);\n        dispatch(getEstablishmentsModules(result.establishments[0].establishment.establishmentModule));\n      }\n\n      dispatch(getSchoolYear());\n    }).catch(err => {});\n  };\n};\nexport const getSchoolYear = () => {\n  return dispatch => {\n    axios.get(`${cst.baseUrl}/school_years/?access_token=${localStorage.token}`).then(res => {\n      if (res) {\n        dispatch({\n          type: FETECHED_ALL_SCHOOL_YEAR_ETAB,\n          payload: res.data\n        });\n      }\n    }).catch(err => {});\n  };\n};\nexport const getEstablishmentsModules = modules => {\n  return {\n    type: \"GET_ESTABLISHMENT_MODULE\",\n    payload: modules\n  };\n};\nexport const resetAccountPassword = data => {\n  return function (dispatch) {\n    var token = localStorage.getItem(\"token\");\n    axios.post(`${cst.baseUrl}/users/reset-initial-password?access_token=${token}`, data, {\n      headers: {\n        \"content-type\": \"application/json\"\n      }\n    }).then(res => {}).catch(error => {});\n  };\n};\nexport function getUserProfile(userId) {\n  return function (dispatch) {\n    axios.get(`${cst.baseUrl}/profiles/findOne?access_token=${localStorage.token}&filter={\"where\":{\"user_id\":` + userId + `}}`).then(res => {\n      const establishmentId = localStorage.establishment_id;\n      let userProfileEstab = { ...res.data,\n        'establishment_id': establishmentId,\n        'school_year_id': localStorage.school_year_id,\n        'school_year_name': localStorage.school_year_name\n      };\n      dispatch({\n        type: GET_USER_PROFILE,\n        payload: userProfileEstab\n      });\n      axios.get(`${cst.baseUrl}/settings/${res.data.setting_id}?access_token=${localStorage.token}`).then(res => {\n        dispatch(getThemeColor(res.data.theme_color));\n        dispatch(getAppLanguage(res.data.app_lang));\n        dispatch(initCalendar(res.data.start_time_calendar, res.data.end_time_calendar));\n      });\n    }).catch(err => {});\n  };\n}\n\nfunction getprofile(userId, dispatch) {\n  axios.get(`${cst.baseUrl}/profiles/findOne?access_token=${localStorage.token}&filter={\"where\":{\"user_id\":` + userId + `}}`).then(res => {\n    const profiles = res.data;\n    localStorage.setItem(\"profileId\", profiles.id);\n    localStorage.setItem(\"roles_id\", profiles.role_id);\n    localStorage.setItem(\"establishment_id\", profiles.establishment_id);\n  }).catch(err => {\n    if (err.response.status === 401) {\n      dispatch(userSignOut());\n    }\n  });\n}\n\nexport const userSignOut = () => {\n  axios.post(`${cst.baseUrl}/users/logout?access_token=${localStorage.token}`);\n  localStorage.removeItem(\"token\");\n  localStorage.removeItem(\"profileId\");\n  localStorage.removeItem(\"roles_id\");\n  localStorage.removeItem(\"user_id\");\n  localStorage.removeItem(\"establishment_id\");\n  return {\n    type: SIGNOUT_USER\n  };\n};\nexport const userSignUpSuccess = authUser => {\n  return {\n    type: SIGNUP_USER_SUCCESS,\n    payload: authUser\n  };\n};\nexport const userSignInSuccess = authUser => {\n  return {\n    type: SIGNIN_USER_SUCCESS,\n    payload: authUser\n  };\n};\nexport const userSignOutSuccess = () => {\n  return {\n    type: SIGNOUT_USER_SUCCESS\n  };\n};\nexport const showAuthMessage = message => {\n  return {\n    type: SHOW_MESSAGE,\n    payload: message\n  };\n};\nexport const userGoogleSignIn = () => {\n  return {\n    type: SIGNIN_GOOGLE_USER\n  };\n};\nexport const userGoogleSignInSuccess = authUser => {\n  return {\n    type: SIGNIN_GOOGLE_USER_SUCCESS,\n    payload: authUser\n  };\n};\nexport const userFacebookSignIn = () => {\n  return {\n    type: SIGNIN_FACEBOOK_USER\n  };\n};\nexport const userFacebookSignInSuccess = authUser => {\n  return {\n    type: SIGNIN_FACEBOOK_USER_SUCCESS,\n    payload: authUser\n  };\n};\nexport const setInitUrl = url => {\n  return {\n    type: INIT_URL,\n    payload: url\n  };\n};\nexport const userTwitterSignIn = () => {\n  return {\n    type: SIGNIN_TWITTER_USER\n  };\n};\nexport const userTwitterSignInSuccess = authUser => {\n  return {\n    type: SIGNIN_TWITTER_USER_SUCCESS,\n    payload: authUser\n  };\n};\nexport const userGithubSignIn = () => {\n  return {\n    type: SIGNIN_GITHUB_USER\n  };\n};\nexport const userGithubSignInSuccess = authUser => {\n  return {\n    type: SIGNIN_GITHUB_USER_SUCCESS,\n    payload: authUser\n  };\n};\nexport const showAuthLoader = () => {\n  return {\n    type: ON_SHOW_LOADER\n  };\n};\nexport const hideMessage = () => {\n  return {\n    type: HIDE_MESSAGE\n  };\n};\nexport const hideAuthLoader = () => {\n  return {\n    type: ON_HIDE_LOADER\n  };\n};\nexport const hideModalSelectEstablishment = () => {\n  return {\n    type: \"HIDE_MODAL_SELECT_ESTABLISHMENT\"\n  };\n};","map":{"version":3,"sources":["/home/oem/Documents/projects/educap/classebook-front-web/src/actions/Auth.js"],"names":["axios","HIDE_MESSAGE","INIT_URL","ON_HIDE_LOADER","ON_SHOW_LOADER","SHOW_MESSAGE","SIGNIN_FACEBOOK_USER","SIGNIN_FACEBOOK_USER_SUCCESS","SIGNIN_GITHUB_USER","SIGNIN_GITHUB_USER_SUCCESS","SIGNIN_GOOGLE_USER","SIGNIN_GOOGLE_USER_SUCCESS","SIGNIN_TWITTER_USER","SIGNIN_TWITTER_USER_SUCCESS","SIGNIN_USER_SUCCESS","SIGNOUT_USER","SIGNOUT_USER_SUCCESS","SIGNUP_USER","SIGNUP_USER_SUCCESS","GET_USER_PROFILE","THEME_COLOR","FETECHED_ALL_SCHOOL_YEAR_ETAB","cst","getError","getThemeColor","getAppLanguage","initCalendar","userSignUp","user","type","payload","userSignIn","email","toLowerCase","trim","password","User","dispatch","post","baseUrl","then","res","localStorage","setItem","data","id","userId","getProfile","catch","err","showAuthMessage","token","getItem","get","result","profile","setting","theme_color","app_lang","start_time_calendar","end_time_calendar","role_id","JSON","stringify","first_connexion","userSignInSuccess","establishments","length","userProfile","Object","assign","establishment_id","getEstablishmentsModules","establishment","establishmentModule","getSchoolYear","modules","resetAccountPassword","headers","error","getUserProfile","establishmentId","userProfileEstab","school_year_id","school_year_name","setting_id","getprofile","profiles","response","status","userSignOut","removeItem","userSignUpSuccess","authUser","userSignOutSuccess","message","userGoogleSignIn","userGoogleSignInSuccess","userFacebookSignIn","userFacebookSignInSuccess","setInitUrl","url","userTwitterSignIn","userTwitterSignInSuccess","userGithubSignIn","userGithubSignInSuccess","showAuthLoader","hideMessage","hideAuthLoader","hideModalSelectEstablishment"],"mappings":"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","sourcesContent":["import axios from \"axios\";\r\nimport {\r\n  HIDE_MESSAGE,\r\n  INIT_URL,\r\n  ON_HIDE_LOADER,\r\n  ON_SHOW_LOADER,\r\n  SHOW_MESSAGE,\r\n  SIGNIN_FACEBOOK_USER,\r\n  SIGNIN_FACEBOOK_USER_SUCCESS,\r\n  SIGNIN_GITHUB_USER,\r\n  SIGNIN_GITHUB_USER_SUCCESS,\r\n  SIGNIN_GOOGLE_USER,\r\n  SIGNIN_GOOGLE_USER_SUCCESS,\r\n  SIGNIN_TWITTER_USER,\r\n  SIGNIN_TWITTER_USER_SUCCESS,\r\n  SIGNIN_USER_SUCCESS,\r\n  SIGNOUT_USER,\r\n  SIGNOUT_USER_SUCCESS,\r\n  SIGNUP_USER,\r\n  SIGNUP_USER_SUCCESS,\r\n  GET_USER_PROFILE,\r\n  THEME_COLOR,\r\n  FETECHED_ALL_SCHOOL_YEAR_ETAB\r\n} from \"../constants/ActionTypes\";\r\nimport cst from \"../config/config\";\r\nimport {\r\n  getError\r\n} from \"../Error/Error\";\r\nimport {\r\n  getThemeColor,\r\n  getAppLanguage,\r\n  initCalendar\r\n} from \"./Setting\";\r\n\r\nexport const userSignUp = (user) => {\r\n  return {\r\n    type: SIGNUP_USER,\r\n    payload: user,\r\n  };\r\n};\r\n\r\nexport const userSignIn = (user) => {\r\n  var email = user.email.toLowerCase().trim();\r\n  var password = user.password;\r\n  const User = {\r\n    email,\r\n    password\r\n  };\r\n  return (dispatch) => {\r\n    axios\r\n      .post(`${cst.baseUrl}/users/login`, User)\r\n      .then((res) => {\r\n        // let id = res.data.id;\r\n        localStorage.setItem(\"token\", res.data.id);\r\n        localStorage.setItem(\"user_id\", res.data.userId);\r\n        dispatch(getProfile(res.data.userId))\r\n\r\n      })\r\n      .catch((err) =>\r\n        dispatch(\r\n          showAuthMessage(\"Veuillez vérifier votre login et mot de passe\")\r\n        )\r\n      );\r\n  };\r\n};\r\n\r\nexport const getProfile = (userId) => {\r\n  let user = {};\r\n\r\n  return function (dispatch) {\r\n    var token = localStorage.getItem(\"token\");\r\n    axios\r\n      .get(\r\n        `${cst.baseUrl}/profiles/getprofile/${userId}?access_token=${token}&filter[include]=user&filter[include]=setting&filter[include]=establishments`\r\n      )\r\n      .then((res) => {\r\n        let result = res.data.profile[0];\r\n        user = result.user;\r\n\r\n        dispatch(getThemeColor(result.setting.theme_color));\r\n        dispatch(getAppLanguage(result.setting.app_lang));\r\n        dispatch(\r\n          initCalendar(\r\n            result.setting.start_time_calendar,\r\n            result.setting.end_time_calendar\r\n          )\r\n        );\r\n        localStorage.setItem(\"profileId\", result.id);\r\n        localStorage.setItem(\"roles_id\", result.role_id);\r\n        localStorage.setItem(\"appLang\", result.app_lang);\r\n        localStorage.setItem(\r\n          \"first_connexion\",\r\n          JSON.stringify(result.user.first_connexion)\r\n        );\r\n        localStorage.setItem(\"user\", JSON.stringify(result.user));\r\n        dispatch(userSignInSuccess(result.user));\r\n        if (result.establishments.length > 1) {\r\n          dispatch({\r\n            type: \"SOW_MODAL_SELECT_ESTABLISHMENT\",\r\n            payload: result,\r\n          });\r\n        } else {\r\n          const userProfile = Object.assign({}, result, {\r\n            establishment_id: result.establishments[0].establishment_id\r\n          });\r\n\r\n          dispatch({\r\n            type: GET_USER_PROFILE,\r\n            payload: userProfile\r\n          });\r\n\r\n          localStorage.setItem(\r\n            \"establishment_id\",\r\n            result.establishments[0].establishment_id\r\n          );\r\n          dispatch(getEstablishmentsModules(result.establishments[0].establishment.establishmentModule));\r\n        }\r\n\r\n        dispatch(getSchoolYear());\r\n      })\r\n      .catch((err) => {\r\n       });\r\n  };\r\n};\r\n\r\nexport const getSchoolYear = () => {\r\n  return (dispatch) => {\r\n    axios.get(`${cst.baseUrl}/school_years/?access_token=${localStorage.token}`)\r\n      .then((res) => {\r\n        if (res) {\r\n          dispatch({\r\n            type: FETECHED_ALL_SCHOOL_YEAR_ETAB,\r\n            payload: res.data,\r\n          });\r\n        }\r\n      })\r\n      .catch((err) => {});\r\n  };\r\n};\r\n\r\n\r\nexport const getEstablishmentsModules = (modules) => {\r\n  return {\r\n    type: \"GET_ESTABLISHMENT_MODULE\",\r\n    payload: modules\r\n  }\r\n};\r\n\r\nexport const resetAccountPassword = (data) => {\r\n  return function (dispatch) {\r\n    var token = localStorage.getItem(\"token\");\r\n    axios\r\n      .post(\r\n        `${cst.baseUrl}/users/reset-initial-password?access_token=${token}`,\r\n        data, {\r\n          headers: {\r\n            \"content-type\": \"application/json\",\r\n          },\r\n        }\r\n      )\r\n      .then((res) => {})\r\n      .catch((error) => {\r\n       });\r\n  };\r\n};\r\n\r\nexport function getUserProfile(userId) {\r\n  return function (dispatch) {\r\n    axios\r\n      .get(\r\n        `${cst.baseUrl}/profiles/findOne?access_token=${localStorage.token}&filter={\"where\":{\"user_id\":` +\r\n        userId + `}}`\r\n      )\r\n      .then((res) => {\r\n        const establishmentId = localStorage.establishment_id;\r\n        let userProfileEstab = {\r\n          ...res.data,\r\n          'establishment_id': establishmentId,\r\n          'school_year_id':localStorage.school_year_id,\r\n          'school_year_name':localStorage.school_year_name\r\n        }\r\n        dispatch({\r\n          type: GET_USER_PROFILE,\r\n          payload: userProfileEstab\r\n        });\r\n        axios\r\n          .get(\r\n            `${cst.baseUrl}/settings/${res.data.setting_id}?access_token=${localStorage.token}`\r\n          )\r\n          .then((res) => {\r\n            dispatch(getThemeColor(res.data.theme_color));\r\n            dispatch(getAppLanguage(res.data.app_lang));\r\n            dispatch(\r\n              initCalendar(\r\n                res.data.start_time_calendar,\r\n                res.data.end_time_calendar\r\n              )\r\n            );\r\n          });\r\n      })\r\n      .catch((err) => {\r\n       });\r\n  };\r\n}\r\n\r\nfunction getprofile(userId, dispatch) {\r\n  axios\r\n    .get(\r\n      `${cst.baseUrl}/profiles/findOne?access_token=${localStorage.token}&filter={\"where\":{\"user_id\":` +\r\n      userId +\r\n      `}}`\r\n    )\r\n    .then((res) => {\r\n      const profiles = res.data;\r\n      localStorage.setItem(\"profileId\", profiles.id);\r\n      localStorage.setItem(\"roles_id\", profiles.role_id);\r\n      localStorage.setItem(\"establishment_id\", profiles.establishment_id);\r\n    })\r\n    .catch((err) => {\r\n      if (err.response.status === 401) {\r\n        dispatch(userSignOut());\r\n      }\r\n    });\r\n}\r\n\r\nexport const userSignOut = () => {\r\n  axios.post(`${cst.baseUrl}/users/logout?access_token=${localStorage.token}`);\r\n  localStorage.removeItem(\"token\");\r\n  localStorage.removeItem(\"profileId\");\r\n  localStorage.removeItem(\"roles_id\");\r\n  localStorage.removeItem(\"user_id\");\r\n  localStorage.removeItem(\"establishment_id\");\r\n\r\n  return {\r\n    type: SIGNOUT_USER,\r\n  };\r\n};\r\n\r\nexport const userSignUpSuccess = (authUser) => {\r\n  return {\r\n    type: SIGNUP_USER_SUCCESS,\r\n    payload: authUser,\r\n  };\r\n};\r\n\r\nexport const userSignInSuccess = (authUser) => {\r\n  return {\r\n    type: SIGNIN_USER_SUCCESS,\r\n    payload: authUser,\r\n  };\r\n};\r\nexport const userSignOutSuccess = () => {\r\n  return {\r\n    type: SIGNOUT_USER_SUCCESS,\r\n  };\r\n};\r\n\r\nexport const showAuthMessage = (message) => {\r\n  return {\r\n    type: SHOW_MESSAGE,\r\n    payload: message,\r\n  };\r\n};\r\n\r\nexport const userGoogleSignIn = () => {\r\n  return {\r\n    type: SIGNIN_GOOGLE_USER,\r\n  };\r\n};\r\nexport const userGoogleSignInSuccess = (authUser) => {\r\n  return {\r\n    type: SIGNIN_GOOGLE_USER_SUCCESS,\r\n    payload: authUser,\r\n  };\r\n};\r\nexport const userFacebookSignIn = () => {\r\n  return {\r\n    type: SIGNIN_FACEBOOK_USER,\r\n  };\r\n};\r\nexport const userFacebookSignInSuccess = (authUser) => {\r\n  return {\r\n    type: SIGNIN_FACEBOOK_USER_SUCCESS,\r\n    payload: authUser,\r\n  };\r\n};\r\nexport const setInitUrl = (url) => {\r\n  return {\r\n    type: INIT_URL,\r\n    payload: url,\r\n  };\r\n};\r\nexport const userTwitterSignIn = () => {\r\n  return {\r\n    type: SIGNIN_TWITTER_USER,\r\n  };\r\n};\r\nexport const userTwitterSignInSuccess = (authUser) => {\r\n  return {\r\n    type: SIGNIN_TWITTER_USER_SUCCESS,\r\n    payload: authUser,\r\n  };\r\n};\r\nexport const userGithubSignIn = () => {\r\n  return {\r\n    type: SIGNIN_GITHUB_USER,\r\n  };\r\n};\r\nexport const userGithubSignInSuccess = (authUser) => {\r\n  return {\r\n    type: SIGNIN_GITHUB_USER_SUCCESS,\r\n    payload: authUser,\r\n  };\r\n};\r\nexport const showAuthLoader = () => {\r\n  return {\r\n    type: ON_SHOW_LOADER,\r\n  };\r\n};\r\n\r\nexport const hideMessage = () => {\r\n  return {\r\n    type: HIDE_MESSAGE,\r\n  };\r\n};\r\nexport const hideAuthLoader = () => {\r\n  return {\r\n    type: ON_HIDE_LOADER,\r\n  };\r\n};\r\nexport const hideModalSelectEstablishment = () => {\r\n  return {\r\n    type: \"HIDE_MODAL_SELECT_ESTABLISHMENT\",\r\n  };\r\n};"]},"metadata":{},"sourceType":"module"}