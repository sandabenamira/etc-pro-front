{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar EnterLeaveCounter_1 = require(\"./EnterLeaveCounter\");\n\nvar BrowserDetector_1 = require(\"./BrowserDetector\");\n\nvar OffsetUtils_1 = require(\"./OffsetUtils\");\n\nvar NativeDragSources_1 = require(\"./NativeDragSources\");\n\nvar NativeTypes = require(\"./NativeTypes\");\n\nvar HTML5Backend =\n/** @class */\nfunction () {\n  function HTML5Backend(manager) {\n    var _this = this;\n\n    this.sourcePreviewNodes = new Map();\n    this.sourcePreviewNodeOptions = new Map();\n    this.sourceNodes = new Map();\n    this.sourceNodeOptions = new Map();\n    this.dragStartSourceIds = null;\n    this.dropTargetIds = [];\n    this.dragEnterTargetIds = [];\n    this.currentNativeSource = null;\n    this.currentNativeHandle = null;\n    this.currentDragSourceNode = null;\n    this.altKeyPressed = false;\n    this.mouseMoveTimeoutTimer = null;\n    this.asyncEndDragFrameId = null;\n    this.dragOverTargetIds = null;\n\n    this.getSourceClientOffset = function (sourceId) {\n      return OffsetUtils_1.getNodeClientOffset(_this.sourceNodes.get(sourceId));\n    };\n\n    this.endDragNativeItem = function () {\n      if (!_this.isDraggingNativeItem()) {\n        return;\n      }\n\n      _this.actions.endDrag();\n\n      _this.registry.removeSource(_this.currentNativeHandle);\n\n      _this.currentNativeHandle = null;\n      _this.currentNativeSource = null;\n    };\n\n    this.isNodeInDocument = function (node) {\n      // Check the node either in the main document or in the current context\n      return !!document && document.body.contains(node) || !!_this.window && _this.window.document.body.contains(node);\n    };\n\n    this.endDragIfSourceWasRemovedFromDOM = function () {\n      var node = _this.currentDragSourceNode;\n\n      if (_this.isNodeInDocument(node)) {\n        return;\n      }\n\n      if (_this.clearCurrentDragSourceNode()) {\n        _this.actions.endDrag();\n      }\n    };\n\n    this.handleTopDragStartCapture = function () {\n      _this.clearCurrentDragSourceNode();\n\n      _this.dragStartSourceIds = [];\n    };\n\n    this.handleTopDragStart = function (e) {\n      var dragStartSourceIds = _this.dragStartSourceIds;\n      _this.dragStartSourceIds = null;\n      var clientOffset = OffsetUtils_1.getEventClientOffset(e); // Avoid crashing if we missed a drop event or our previous drag died\n\n      if (_this.monitor.isDragging()) {\n        _this.actions.endDrag();\n      } // Don't publish the source just yet (see why below)\n\n\n      _this.actions.beginDrag(dragStartSourceIds || [], {\n        publishSource: false,\n        getSourceClientOffset: _this.getSourceClientOffset,\n        clientOffset: clientOffset\n      });\n\n      var dataTransfer = e.dataTransfer;\n      var nativeType = NativeDragSources_1.matchNativeItemType(dataTransfer);\n\n      if (_this.monitor.isDragging()) {\n        if (dataTransfer && typeof dataTransfer.setDragImage === 'function') {\n          // Use custom drag image if user specifies it.\n          // If child drag source refuses drag but parent agrees,\n          // use parent's node as drag image. Neither works in IE though.\n          var sourceId = _this.monitor.getSourceId();\n\n          var sourceNode = _this.sourceNodes.get(sourceId);\n\n          var dragPreview = _this.sourcePreviewNodes.get(sourceId) || sourceNode;\n\n          if (dragPreview) {\n            var _a = _this.getCurrentSourcePreviewNodeOptions(),\n                anchorX = _a.anchorX,\n                anchorY = _a.anchorY,\n                offsetX = _a.offsetX,\n                offsetY = _a.offsetY;\n\n            var anchorPoint = {\n              anchorX: anchorX,\n              anchorY: anchorY\n            };\n            var offsetPoint = {\n              offsetX: offsetX,\n              offsetY: offsetY\n            };\n            var dragPreviewOffset = OffsetUtils_1.getDragPreviewOffset(sourceNode, dragPreview, clientOffset, anchorPoint, offsetPoint);\n            dataTransfer.setDragImage(dragPreview, dragPreviewOffset.x, dragPreviewOffset.y);\n          }\n        }\n\n        try {\n          // Firefox won't drag without setting data\n          dataTransfer.setData('application/json', {});\n        } catch (err) {// IE doesn't support MIME types in setData\n        } // Store drag source node so we can check whether\n        // it is removed from DOM and trigger endDrag manually.\n\n\n        _this.setCurrentDragSourceNode(e.target); // Now we are ready to publish the drag source.. or are we not?\n\n\n        var captureDraggingState = _this.getCurrentSourcePreviewNodeOptions().captureDraggingState;\n\n        if (!captureDraggingState) {\n          // Usually we want to publish it in the next tick so that browser\n          // is able to screenshot the current (not yet dragging) state.\n          //\n          // It also neatly avoids a situation where render() returns null\n          // in the same tick for the source element, and browser freaks out.\n          setTimeout(function () {\n            return _this.actions.publishDragSource();\n          }, 0);\n        } else {\n          // In some cases the user may want to override this behavior, e.g.\n          // to work around IE not supporting custom drag previews.\n          //\n          // When using a custom drag layer, the only way to prevent\n          // the default drag preview from drawing in IE is to screenshot\n          // the dragging state in which the node itself has zero opacity\n          // and height. In this case, though, returning null from render()\n          // will abruptly end the dragging, which is not obvious.\n          //\n          // This is the reason such behavior is strictly opt-in.\n          _this.actions.publishDragSource();\n        }\n      } else if (nativeType) {\n        // A native item (such as URL) dragged from inside the document\n        _this.beginDragNativeItem(nativeType);\n      } else if (dataTransfer && !dataTransfer.types && (e.target && !e.target.hasAttribute || !e.target.hasAttribute('draggable'))) {\n        // Looks like a Safari bug: dataTransfer.types is null, but there was no draggable.\n        // Just let it drag. It's a native type (URL or text) and will be picked up in\n        // dragenter handler.\n        return;\n      } else {\n        // If by this time no drag source reacted, tell browser not to drag.\n        e.preventDefault();\n      }\n    };\n\n    this.handleTopDragEndCapture = function () {\n      if (_this.clearCurrentDragSourceNode()) {\n        // Firefox can dispatch this event in an infinite loop\n        // if dragend handler does something like showing an alert.\n        // Only proceed if we have not handled it already.\n        _this.actions.endDrag();\n      }\n    };\n\n    this.handleTopDragEnterCapture = function (e) {\n      _this.dragEnterTargetIds = [];\n\n      var isFirstEnter = _this.enterLeaveCounter.enter(e.target);\n\n      if (!isFirstEnter || _this.monitor.isDragging()) {\n        return;\n      }\n\n      var dataTransfer = e.dataTransfer;\n      var nativeType = NativeDragSources_1.matchNativeItemType(dataTransfer);\n\n      if (nativeType) {\n        // A native item (such as file or URL) dragged from outside the document\n        _this.beginDragNativeItem(nativeType);\n      }\n    };\n\n    this.handleTopDragEnter = function (e) {\n      var dragEnterTargetIds = _this.dragEnterTargetIds;\n      _this.dragEnterTargetIds = [];\n\n      if (!_this.monitor.isDragging()) {\n        // This is probably a native item type we don't understand.\n        return;\n      }\n\n      _this.altKeyPressed = e.altKey;\n\n      if (!BrowserDetector_1.isFirefox()) {\n        // Don't emit hover in `dragenter` on Firefox due to an edge case.\n        // If the target changes position as the result of `dragenter`, Firefox\n        // will still happily dispatch `dragover` despite target being no longer\n        // there. The easy solution is to only fire `hover` in `dragover` on FF.\n        _this.actions.hover(dragEnterTargetIds, {\n          clientOffset: OffsetUtils_1.getEventClientOffset(e)\n        });\n      }\n\n      var canDrop = dragEnterTargetIds.some(function (targetId) {\n        return _this.monitor.canDropOnTarget(targetId);\n      });\n\n      if (canDrop) {\n        // IE requires this to fire dragover events\n        e.preventDefault();\n\n        if (e.dataTransfer) {\n          e.dataTransfer.dropEffect = _this.getCurrentDropEffect();\n        }\n      }\n    };\n\n    this.handleTopDragOverCapture = function () {\n      _this.dragOverTargetIds = [];\n    };\n\n    this.handleTopDragOver = function (e) {\n      var dragOverTargetIds = _this.dragOverTargetIds;\n      _this.dragOverTargetIds = [];\n\n      if (!_this.monitor.isDragging()) {\n        // This is probably a native item type we don't understand.\n        // Prevent default \"drop and blow away the whole document\" action.\n        e.preventDefault();\n\n        if (e.dataTransfer) {\n          e.dataTransfer.dropEffect = 'none';\n        }\n\n        return;\n      }\n\n      _this.altKeyPressed = e.altKey;\n\n      _this.actions.hover(dragOverTargetIds || [], {\n        clientOffset: OffsetUtils_1.getEventClientOffset(e)\n      });\n\n      var canDrop = (dragOverTargetIds || []).some(function (targetId) {\n        return _this.monitor.canDropOnTarget(targetId);\n      });\n\n      if (canDrop) {\n        // Show user-specified drop effect.\n        e.preventDefault();\n\n        if (e.dataTransfer) {\n          e.dataTransfer.dropEffect = _this.getCurrentDropEffect();\n        }\n      } else if (_this.isDraggingNativeItem()) {\n        // Don't show a nice cursor but still prevent default\n        // \"drop and blow away the whole document\" action.\n        e.preventDefault();\n      } else {\n        e.preventDefault();\n\n        if (e.dataTransfer) {\n          e.dataTransfer.dropEffect = 'none';\n        }\n      }\n    };\n\n    this.handleTopDragLeaveCapture = function (e) {\n      if (_this.isDraggingNativeItem()) {\n        e.preventDefault();\n      }\n\n      var isLastLeave = _this.enterLeaveCounter.leave(e.target);\n\n      if (!isLastLeave) {\n        return;\n      }\n\n      if (_this.isDraggingNativeItem()) {\n        _this.endDragNativeItem();\n      }\n    };\n\n    this.handleTopDropCapture = function (e) {\n      _this.dropTargetIds = [];\n      e.preventDefault();\n\n      if (_this.isDraggingNativeItem()) {\n        _this.currentNativeSource.mutateItemByReadingDataTransfer(e.dataTransfer);\n      }\n\n      _this.enterLeaveCounter.reset();\n    };\n\n    this.handleTopDrop = function (e) {\n      var dropTargetIds = _this.dropTargetIds;\n      _this.dropTargetIds = [];\n\n      _this.actions.hover(dropTargetIds, {\n        clientOffset: OffsetUtils_1.getEventClientOffset(e)\n      });\n\n      _this.actions.drop({\n        dropEffect: _this.getCurrentDropEffect()\n      });\n\n      if (_this.isDraggingNativeItem()) {\n        _this.endDragNativeItem();\n      } else {\n        _this.endDragIfSourceWasRemovedFromDOM();\n      }\n    };\n\n    this.handleSelectStart = function (e) {\n      var target = e.target; // Only IE requires us to explicitly say\n      // we want drag drop operation to start\n\n      if (typeof target.dragDrop !== 'function') {\n        return;\n      } // Inputs and textareas should be selectable\n\n\n      if (target.tagName === 'INPUT' || target.tagName === 'SELECT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {\n        return;\n      } // For other targets, ask IE\n      // to enable drag and drop\n\n\n      e.preventDefault();\n      target.dragDrop();\n    };\n\n    this.actions = manager.getActions();\n    this.monitor = manager.getMonitor();\n    this.registry = manager.getRegistry();\n    this.context = manager.getContext();\n    this.enterLeaveCounter = new EnterLeaveCounter_1.default(this.isNodeInDocument);\n  }\n\n  Object.defineProperty(HTML5Backend.prototype, \"window\", {\n    // public for test\n    get: function () {\n      if (this.context && this.context.window) {\n        return this.context.window;\n      } else if (typeof window !== 'undefined') {\n        return window;\n      }\n\n      return undefined;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  HTML5Backend.prototype.setup = function () {\n    if (this.window === undefined) {\n      return;\n    }\n\n    if (this.window.__isReactDndBackendSetUp) {\n      throw new Error('Cannot have two HTML5 backends at the same time.');\n    }\n\n    this.window.__isReactDndBackendSetUp = true;\n    this.addEventListeners(this.window);\n  };\n\n  HTML5Backend.prototype.teardown = function () {\n    if (this.window === undefined) {\n      return;\n    }\n\n    this.window.__isReactDndBackendSetUp = false;\n    this.removeEventListeners(this.window);\n    this.clearCurrentDragSourceNode();\n\n    if (this.asyncEndDragFrameId) {\n      this.window.cancelAnimationFrame(this.asyncEndDragFrameId);\n    }\n  };\n\n  HTML5Backend.prototype.connectDragPreview = function (sourceId, node, options) {\n    var _this = this;\n\n    this.sourcePreviewNodeOptions.set(sourceId, options);\n    this.sourcePreviewNodes.set(sourceId, node);\n    return function () {\n      _this.sourcePreviewNodes.delete(sourceId);\n\n      _this.sourcePreviewNodeOptions.delete(sourceId);\n    };\n  };\n\n  HTML5Backend.prototype.connectDragSource = function (sourceId, node, options) {\n    var _this = this;\n\n    this.sourceNodes.set(sourceId, node);\n    this.sourceNodeOptions.set(sourceId, options);\n\n    var handleDragStart = function (e) {\n      return _this.handleDragStart(e, sourceId);\n    };\n\n    var handleSelectStart = function (e) {\n      return _this.handleSelectStart(e);\n    };\n\n    node.setAttribute('draggable', 'true');\n    node.addEventListener('dragstart', handleDragStart);\n    node.addEventListener('selectstart', handleSelectStart);\n    return function () {\n      _this.sourceNodes.delete(sourceId);\n\n      _this.sourceNodeOptions.delete(sourceId);\n\n      node.removeEventListener('dragstart', handleDragStart);\n      node.removeEventListener('selectstart', handleSelectStart);\n      node.setAttribute('draggable', 'false');\n    };\n  };\n\n  HTML5Backend.prototype.connectDropTarget = function (targetId, node) {\n    var _this = this;\n\n    var handleDragEnter = function (e) {\n      return _this.handleDragEnter(e, targetId);\n    };\n\n    var handleDragOver = function (e) {\n      return _this.handleDragOver(e, targetId);\n    };\n\n    var handleDrop = function (e) {\n      return _this.handleDrop(e, targetId);\n    };\n\n    node.addEventListener('dragenter', handleDragEnter);\n    node.addEventListener('dragover', handleDragOver);\n    node.addEventListener('drop', handleDrop);\n    return function () {\n      node.removeEventListener('dragenter', handleDragEnter);\n      node.removeEventListener('dragover', handleDragOver);\n      node.removeEventListener('drop', handleDrop);\n    };\n  };\n\n  HTML5Backend.prototype.addEventListeners = function (target) {\n    // SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n    if (!target.addEventListener) {\n      return;\n    }\n\n    target.addEventListener('dragstart', this.handleTopDragStart);\n    target.addEventListener('dragstart', this.handleTopDragStartCapture, true);\n    target.addEventListener('dragend', this.handleTopDragEndCapture, true);\n    target.addEventListener('dragenter', this.handleTopDragEnter);\n    target.addEventListener('dragenter', this.handleTopDragEnterCapture, true);\n    target.addEventListener('dragleave', this.handleTopDragLeaveCapture, true);\n    target.addEventListener('dragover', this.handleTopDragOver);\n    target.addEventListener('dragover', this.handleTopDragOverCapture, true);\n    target.addEventListener('drop', this.handleTopDrop);\n    target.addEventListener('drop', this.handleTopDropCapture, true);\n  };\n\n  HTML5Backend.prototype.removeEventListeners = function (target) {\n    // SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n    if (!target.removeEventListener) {\n      return;\n    }\n\n    target.removeEventListener('dragstart', this.handleTopDragStart);\n    target.removeEventListener('dragstart', this.handleTopDragStartCapture, true);\n    target.removeEventListener('dragend', this.handleTopDragEndCapture, true);\n    target.removeEventListener('dragenter', this.handleTopDragEnter);\n    target.removeEventListener('dragenter', this.handleTopDragEnterCapture, true);\n    target.removeEventListener('dragleave', this.handleTopDragLeaveCapture, true);\n    target.removeEventListener('dragover', this.handleTopDragOver);\n    target.removeEventListener('dragover', this.handleTopDragOverCapture, true);\n    target.removeEventListener('drop', this.handleTopDrop);\n    target.removeEventListener('drop', this.handleTopDropCapture, true);\n  };\n\n  HTML5Backend.prototype.getCurrentSourceNodeOptions = function () {\n    var sourceId = this.monitor.getSourceId();\n    var sourceNodeOptions = this.sourceNodeOptions.get(sourceId);\n    return __assign({\n      dropEffect: this.altKeyPressed ? 'copy' : 'move'\n    }, sourceNodeOptions || {});\n  };\n\n  HTML5Backend.prototype.getCurrentDropEffect = function () {\n    if (this.isDraggingNativeItem()) {\n      // It makes more sense to default to 'copy' for native resources\n      return 'copy';\n    }\n\n    return this.getCurrentSourceNodeOptions().dropEffect;\n  };\n\n  HTML5Backend.prototype.getCurrentSourcePreviewNodeOptions = function () {\n    var sourceId = this.monitor.getSourceId();\n    var sourcePreviewNodeOptions = this.sourcePreviewNodeOptions.get(sourceId);\n    return __assign({\n      anchorX: 0.5,\n      anchorY: 0.5,\n      captureDraggingState: false\n    }, sourcePreviewNodeOptions || {});\n  };\n\n  HTML5Backend.prototype.isDraggingNativeItem = function () {\n    var itemType = this.monitor.getItemType();\n    return Object.keys(NativeTypes).some(function (key) {\n      return NativeTypes[key] === itemType;\n    });\n  };\n\n  HTML5Backend.prototype.beginDragNativeItem = function (type) {\n    this.clearCurrentDragSourceNode();\n    this.currentNativeSource = NativeDragSources_1.createNativeDragSource(type);\n    this.currentNativeHandle = this.registry.addSource(type, this.currentNativeSource);\n    this.actions.beginDrag([this.currentNativeHandle]);\n  };\n\n  HTML5Backend.prototype.setCurrentDragSourceNode = function (node) {\n    var _this = this;\n\n    this.clearCurrentDragSourceNode();\n    this.currentDragSourceNode = node; // A timeout of > 0 is necessary to resolve Firefox issue referenced\n    // See:\n    //   * https://github.com/react-dnd/react-dnd/pull/928\n    //   * https://github.com/react-dnd/react-dnd/issues/869\n\n    var MOUSE_MOVE_TIMEOUT = 1000; // Receiving a mouse event in the middle of a dragging operation\n    // means it has ended and the drag source node disappeared from DOM,\n    // so the browser didn't dispatch the dragend event.\n    //\n    // We need to wait before we start listening for mousemove events.\n    // This is needed because the drag preview needs to be drawn or else it fires an 'mousemove' event\n    // immediately in some browsers.\n    //\n    // See:\n    //   * https://github.com/react-dnd/react-dnd/pull/928\n    //   * https://github.com/react-dnd/react-dnd/issues/869\n    //\n\n    this.mouseMoveTimeoutTimer = setTimeout(function () {\n      return _this.window && _this.window.addEventListener('mousemove', _this.endDragIfSourceWasRemovedFromDOM, true);\n    }, MOUSE_MOVE_TIMEOUT);\n  };\n\n  HTML5Backend.prototype.clearCurrentDragSourceNode = function () {\n    if (this.currentDragSourceNode) {\n      this.currentDragSourceNode = null;\n\n      if (this.window) {\n        this.window.clearTimeout(this.mouseMoveTimeoutTimer || undefined);\n        this.window.removeEventListener('mousemove', this.endDragIfSourceWasRemovedFromDOM, true);\n      }\n\n      this.mouseMoveTimeoutTimer = null;\n      return true;\n    }\n\n    return false;\n  };\n\n  HTML5Backend.prototype.handleDragStart = function (e, sourceId) {\n    if (!this.dragStartSourceIds) {\n      this.dragStartSourceIds = [];\n    }\n\n    this.dragStartSourceIds.unshift(sourceId);\n  };\n\n  HTML5Backend.prototype.handleDragEnter = function (e, targetId) {\n    this.dragEnterTargetIds.unshift(targetId);\n  };\n\n  HTML5Backend.prototype.handleDragOver = function (e, targetId) {\n    if (this.dragOverTargetIds === null) {\n      this.dragOverTargetIds = [];\n    }\n\n    this.dragOverTargetIds.unshift(targetId);\n  };\n\n  HTML5Backend.prototype.handleDrop = function (e, targetId) {\n    this.dropTargetIds.unshift(targetId);\n  };\n\n  return HTML5Backend;\n}();\n\nexports.default = HTML5Backend;","map":{"version":3,"sources":["/home/oem/Documents/projects/educap/classebook-front-web/node_modules/react-dnd-html5-backend/lib/cjs/HTML5Backend.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","defineProperty","exports","value","EnterLeaveCounter_1","require","BrowserDetector_1","OffsetUtils_1","NativeDragSources_1","NativeTypes","HTML5Backend","manager","_this","sourcePreviewNodes","Map","sourcePreviewNodeOptions","sourceNodes","sourceNodeOptions","dragStartSourceIds","dropTargetIds","dragEnterTargetIds","currentNativeSource","currentNativeHandle","currentDragSourceNode","altKeyPressed","mouseMoveTimeoutTimer","asyncEndDragFrameId","dragOverTargetIds","getSourceClientOffset","sourceId","getNodeClientOffset","get","endDragNativeItem","isDraggingNativeItem","actions","endDrag","registry","removeSource","isNodeInDocument","node","document","body","contains","window","endDragIfSourceWasRemovedFromDOM","clearCurrentDragSourceNode","handleTopDragStartCapture","handleTopDragStart","e","clientOffset","getEventClientOffset","monitor","isDragging","beginDrag","publishSource","dataTransfer","nativeType","matchNativeItemType","setDragImage","getSourceId","sourceNode","dragPreview","_a","getCurrentSourcePreviewNodeOptions","anchorX","anchorY","offsetX","offsetY","anchorPoint","offsetPoint","dragPreviewOffset","getDragPreviewOffset","x","y","setData","err","setCurrentDragSourceNode","target","captureDraggingState","setTimeout","publishDragSource","beginDragNativeItem","types","hasAttribute","preventDefault","handleTopDragEndCapture","handleTopDragEnterCapture","isFirstEnter","enterLeaveCounter","enter","handleTopDragEnter","altKey","isFirefox","hover","canDrop","some","targetId","canDropOnTarget","dropEffect","getCurrentDropEffect","handleTopDragOverCapture","handleTopDragOver","handleTopDragLeaveCapture","isLastLeave","leave","handleTopDropCapture","mutateItemByReadingDataTransfer","reset","handleTopDrop","drop","handleSelectStart","dragDrop","tagName","isContentEditable","getActions","getMonitor","getRegistry","context","getContext","default","undefined","enumerable","configurable","setup","__isReactDndBackendSetUp","Error","addEventListeners","teardown","removeEventListeners","cancelAnimationFrame","connectDragPreview","options","set","delete","connectDragSource","handleDragStart","setAttribute","addEventListener","removeEventListener","connectDropTarget","handleDragEnter","handleDragOver","handleDrop","getCurrentSourceNodeOptions","itemType","getItemType","keys","key","type","createNativeDragSource","addSource","MOUSE_MOVE_TIMEOUT","clearTimeout","unshift"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar EnterLeaveCounter_1 = require(\"./EnterLeaveCounter\");\nvar BrowserDetector_1 = require(\"./BrowserDetector\");\nvar OffsetUtils_1 = require(\"./OffsetUtils\");\nvar NativeDragSources_1 = require(\"./NativeDragSources\");\nvar NativeTypes = require(\"./NativeTypes\");\nvar HTML5Backend = /** @class */ (function () {\n    function HTML5Backend(manager) {\n        var _this = this;\n        this.sourcePreviewNodes = new Map();\n        this.sourcePreviewNodeOptions = new Map();\n        this.sourceNodes = new Map();\n        this.sourceNodeOptions = new Map();\n        this.dragStartSourceIds = null;\n        this.dropTargetIds = [];\n        this.dragEnterTargetIds = [];\n        this.currentNativeSource = null;\n        this.currentNativeHandle = null;\n        this.currentDragSourceNode = null;\n        this.altKeyPressed = false;\n        this.mouseMoveTimeoutTimer = null;\n        this.asyncEndDragFrameId = null;\n        this.dragOverTargetIds = null;\n        this.getSourceClientOffset = function (sourceId) {\n            return OffsetUtils_1.getNodeClientOffset(_this.sourceNodes.get(sourceId));\n        };\n        this.endDragNativeItem = function () {\n            if (!_this.isDraggingNativeItem()) {\n                return;\n            }\n            _this.actions.endDrag();\n            _this.registry.removeSource(_this.currentNativeHandle);\n            _this.currentNativeHandle = null;\n            _this.currentNativeSource = null;\n        };\n        this.isNodeInDocument = function (node) {\n            // Check the node either in the main document or in the current context\n            return ((!!document && document.body.contains(node)) ||\n                (!!_this.window && _this.window.document.body.contains(node)));\n        };\n        this.endDragIfSourceWasRemovedFromDOM = function () {\n            var node = _this.currentDragSourceNode;\n            if (_this.isNodeInDocument(node)) {\n                return;\n            }\n            if (_this.clearCurrentDragSourceNode()) {\n                _this.actions.endDrag();\n            }\n        };\n        this.handleTopDragStartCapture = function () {\n            _this.clearCurrentDragSourceNode();\n            _this.dragStartSourceIds = [];\n        };\n        this.handleTopDragStart = function (e) {\n            var dragStartSourceIds = _this.dragStartSourceIds;\n            _this.dragStartSourceIds = null;\n            var clientOffset = OffsetUtils_1.getEventClientOffset(e);\n            // Avoid crashing if we missed a drop event or our previous drag died\n            if (_this.monitor.isDragging()) {\n                _this.actions.endDrag();\n            }\n            // Don't publish the source just yet (see why below)\n            _this.actions.beginDrag(dragStartSourceIds || [], {\n                publishSource: false,\n                getSourceClientOffset: _this.getSourceClientOffset,\n                clientOffset: clientOffset,\n            });\n            var dataTransfer = e.dataTransfer;\n            var nativeType = NativeDragSources_1.matchNativeItemType(dataTransfer);\n            if (_this.monitor.isDragging()) {\n                if (dataTransfer && typeof dataTransfer.setDragImage === 'function') {\n                    // Use custom drag image if user specifies it.\n                    // If child drag source refuses drag but parent agrees,\n                    // use parent's node as drag image. Neither works in IE though.\n                    var sourceId = _this.monitor.getSourceId();\n                    var sourceNode = _this.sourceNodes.get(sourceId);\n                    var dragPreview = _this.sourcePreviewNodes.get(sourceId) || sourceNode;\n                    if (dragPreview) {\n                        var _a = _this.getCurrentSourcePreviewNodeOptions(), anchorX = _a.anchorX, anchorY = _a.anchorY, offsetX = _a.offsetX, offsetY = _a.offsetY;\n                        var anchorPoint = { anchorX: anchorX, anchorY: anchorY };\n                        var offsetPoint = { offsetX: offsetX, offsetY: offsetY };\n                        var dragPreviewOffset = OffsetUtils_1.getDragPreviewOffset(sourceNode, dragPreview, clientOffset, anchorPoint, offsetPoint);\n                        dataTransfer.setDragImage(dragPreview, dragPreviewOffset.x, dragPreviewOffset.y);\n                    }\n                }\n                try {\n                    // Firefox won't drag without setting data\n                    dataTransfer.setData('application/json', {});\n                }\n                catch (err) {\n                    // IE doesn't support MIME types in setData\n                }\n                // Store drag source node so we can check whether\n                // it is removed from DOM and trigger endDrag manually.\n                _this.setCurrentDragSourceNode(e.target);\n                // Now we are ready to publish the drag source.. or are we not?\n                var captureDraggingState = _this.getCurrentSourcePreviewNodeOptions().captureDraggingState;\n                if (!captureDraggingState) {\n                    // Usually we want to publish it in the next tick so that browser\n                    // is able to screenshot the current (not yet dragging) state.\n                    //\n                    // It also neatly avoids a situation where render() returns null\n                    // in the same tick for the source element, and browser freaks out.\n                    setTimeout(function () { return _this.actions.publishDragSource(); }, 0);\n                }\n                else {\n                    // In some cases the user may want to override this behavior, e.g.\n                    // to work around IE not supporting custom drag previews.\n                    //\n                    // When using a custom drag layer, the only way to prevent\n                    // the default drag preview from drawing in IE is to screenshot\n                    // the dragging state in which the node itself has zero opacity\n                    // and height. In this case, though, returning null from render()\n                    // will abruptly end the dragging, which is not obvious.\n                    //\n                    // This is the reason such behavior is strictly opt-in.\n                    _this.actions.publishDragSource();\n                }\n            }\n            else if (nativeType) {\n                // A native item (such as URL) dragged from inside the document\n                _this.beginDragNativeItem(nativeType);\n            }\n            else if (dataTransfer &&\n                !dataTransfer.types &&\n                ((e.target && !e.target.hasAttribute) ||\n                    !e.target.hasAttribute('draggable'))) {\n                // Looks like a Safari bug: dataTransfer.types is null, but there was no draggable.\n                // Just let it drag. It's a native type (URL or text) and will be picked up in\n                // dragenter handler.\n                return;\n            }\n            else {\n                // If by this time no drag source reacted, tell browser not to drag.\n                e.preventDefault();\n            }\n        };\n        this.handleTopDragEndCapture = function () {\n            if (_this.clearCurrentDragSourceNode()) {\n                // Firefox can dispatch this event in an infinite loop\n                // if dragend handler does something like showing an alert.\n                // Only proceed if we have not handled it already.\n                _this.actions.endDrag();\n            }\n        };\n        this.handleTopDragEnterCapture = function (e) {\n            _this.dragEnterTargetIds = [];\n            var isFirstEnter = _this.enterLeaveCounter.enter(e.target);\n            if (!isFirstEnter || _this.monitor.isDragging()) {\n                return;\n            }\n            var dataTransfer = e.dataTransfer;\n            var nativeType = NativeDragSources_1.matchNativeItemType(dataTransfer);\n            if (nativeType) {\n                // A native item (such as file or URL) dragged from outside the document\n                _this.beginDragNativeItem(nativeType);\n            }\n        };\n        this.handleTopDragEnter = function (e) {\n            var dragEnterTargetIds = _this.dragEnterTargetIds;\n            _this.dragEnterTargetIds = [];\n            if (!_this.monitor.isDragging()) {\n                // This is probably a native item type we don't understand.\n                return;\n            }\n            _this.altKeyPressed = e.altKey;\n            if (!BrowserDetector_1.isFirefox()) {\n                // Don't emit hover in `dragenter` on Firefox due to an edge case.\n                // If the target changes position as the result of `dragenter`, Firefox\n                // will still happily dispatch `dragover` despite target being no longer\n                // there. The easy solution is to only fire `hover` in `dragover` on FF.\n                _this.actions.hover(dragEnterTargetIds, {\n                    clientOffset: OffsetUtils_1.getEventClientOffset(e),\n                });\n            }\n            var canDrop = dragEnterTargetIds.some(function (targetId) {\n                return _this.monitor.canDropOnTarget(targetId);\n            });\n            if (canDrop) {\n                // IE requires this to fire dragover events\n                e.preventDefault();\n                if (e.dataTransfer) {\n                    e.dataTransfer.dropEffect = _this.getCurrentDropEffect();\n                }\n            }\n        };\n        this.handleTopDragOverCapture = function () {\n            _this.dragOverTargetIds = [];\n        };\n        this.handleTopDragOver = function (e) {\n            var dragOverTargetIds = _this.dragOverTargetIds;\n            _this.dragOverTargetIds = [];\n            if (!_this.monitor.isDragging()) {\n                // This is probably a native item type we don't understand.\n                // Prevent default \"drop and blow away the whole document\" action.\n                e.preventDefault();\n                if (e.dataTransfer) {\n                    e.dataTransfer.dropEffect = 'none';\n                }\n                return;\n            }\n            _this.altKeyPressed = e.altKey;\n            _this.actions.hover(dragOverTargetIds || [], {\n                clientOffset: OffsetUtils_1.getEventClientOffset(e),\n            });\n            var canDrop = (dragOverTargetIds || []).some(function (targetId) {\n                return _this.monitor.canDropOnTarget(targetId);\n            });\n            if (canDrop) {\n                // Show user-specified drop effect.\n                e.preventDefault();\n                if (e.dataTransfer) {\n                    e.dataTransfer.dropEffect = _this.getCurrentDropEffect();\n                }\n            }\n            else if (_this.isDraggingNativeItem()) {\n                // Don't show a nice cursor but still prevent default\n                // \"drop and blow away the whole document\" action.\n                e.preventDefault();\n            }\n            else {\n                e.preventDefault();\n                if (e.dataTransfer) {\n                    e.dataTransfer.dropEffect = 'none';\n                }\n            }\n        };\n        this.handleTopDragLeaveCapture = function (e) {\n            if (_this.isDraggingNativeItem()) {\n                e.preventDefault();\n            }\n            var isLastLeave = _this.enterLeaveCounter.leave(e.target);\n            if (!isLastLeave) {\n                return;\n            }\n            if (_this.isDraggingNativeItem()) {\n                _this.endDragNativeItem();\n            }\n        };\n        this.handleTopDropCapture = function (e) {\n            _this.dropTargetIds = [];\n            e.preventDefault();\n            if (_this.isDraggingNativeItem()) {\n                _this.currentNativeSource.mutateItemByReadingDataTransfer(e.dataTransfer);\n            }\n            _this.enterLeaveCounter.reset();\n        };\n        this.handleTopDrop = function (e) {\n            var dropTargetIds = _this.dropTargetIds;\n            _this.dropTargetIds = [];\n            _this.actions.hover(dropTargetIds, {\n                clientOffset: OffsetUtils_1.getEventClientOffset(e),\n            });\n            _this.actions.drop({ dropEffect: _this.getCurrentDropEffect() });\n            if (_this.isDraggingNativeItem()) {\n                _this.endDragNativeItem();\n            }\n            else {\n                _this.endDragIfSourceWasRemovedFromDOM();\n            }\n        };\n        this.handleSelectStart = function (e) {\n            var target = e.target;\n            // Only IE requires us to explicitly say\n            // we want drag drop operation to start\n            if (typeof target.dragDrop !== 'function') {\n                return;\n            }\n            // Inputs and textareas should be selectable\n            if (target.tagName === 'INPUT' ||\n                target.tagName === 'SELECT' ||\n                target.tagName === 'TEXTAREA' ||\n                target.isContentEditable) {\n                return;\n            }\n            // For other targets, ask IE\n            // to enable drag and drop\n            e.preventDefault();\n            target.dragDrop();\n        };\n        this.actions = manager.getActions();\n        this.monitor = manager.getMonitor();\n        this.registry = manager.getRegistry();\n        this.context = manager.getContext();\n        this.enterLeaveCounter = new EnterLeaveCounter_1.default(this.isNodeInDocument);\n    }\n    Object.defineProperty(HTML5Backend.prototype, \"window\", {\n        // public for test\n        get: function () {\n            if (this.context && this.context.window) {\n                return this.context.window;\n            }\n            else if (typeof window !== 'undefined') {\n                return window;\n            }\n            return undefined;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    HTML5Backend.prototype.setup = function () {\n        if (this.window === undefined) {\n            return;\n        }\n        if (this.window.__isReactDndBackendSetUp) {\n            throw new Error('Cannot have two HTML5 backends at the same time.');\n        }\n        this.window.__isReactDndBackendSetUp = true;\n        this.addEventListeners(this.window);\n    };\n    HTML5Backend.prototype.teardown = function () {\n        if (this.window === undefined) {\n            return;\n        }\n        this.window.__isReactDndBackendSetUp = false;\n        this.removeEventListeners(this.window);\n        this.clearCurrentDragSourceNode();\n        if (this.asyncEndDragFrameId) {\n            this.window.cancelAnimationFrame(this.asyncEndDragFrameId);\n        }\n    };\n    HTML5Backend.prototype.connectDragPreview = function (sourceId, node, options) {\n        var _this = this;\n        this.sourcePreviewNodeOptions.set(sourceId, options);\n        this.sourcePreviewNodes.set(sourceId, node);\n        return function () {\n            _this.sourcePreviewNodes.delete(sourceId);\n            _this.sourcePreviewNodeOptions.delete(sourceId);\n        };\n    };\n    HTML5Backend.prototype.connectDragSource = function (sourceId, node, options) {\n        var _this = this;\n        this.sourceNodes.set(sourceId, node);\n        this.sourceNodeOptions.set(sourceId, options);\n        var handleDragStart = function (e) { return _this.handleDragStart(e, sourceId); };\n        var handleSelectStart = function (e) { return _this.handleSelectStart(e); };\n        node.setAttribute('draggable', 'true');\n        node.addEventListener('dragstart', handleDragStart);\n        node.addEventListener('selectstart', handleSelectStart);\n        return function () {\n            _this.sourceNodes.delete(sourceId);\n            _this.sourceNodeOptions.delete(sourceId);\n            node.removeEventListener('dragstart', handleDragStart);\n            node.removeEventListener('selectstart', handleSelectStart);\n            node.setAttribute('draggable', 'false');\n        };\n    };\n    HTML5Backend.prototype.connectDropTarget = function (targetId, node) {\n        var _this = this;\n        var handleDragEnter = function (e) { return _this.handleDragEnter(e, targetId); };\n        var handleDragOver = function (e) { return _this.handleDragOver(e, targetId); };\n        var handleDrop = function (e) { return _this.handleDrop(e, targetId); };\n        node.addEventListener('dragenter', handleDragEnter);\n        node.addEventListener('dragover', handleDragOver);\n        node.addEventListener('drop', handleDrop);\n        return function () {\n            node.removeEventListener('dragenter', handleDragEnter);\n            node.removeEventListener('dragover', handleDragOver);\n            node.removeEventListener('drop', handleDrop);\n        };\n    };\n    HTML5Backend.prototype.addEventListeners = function (target) {\n        // SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n        if (!target.addEventListener) {\n            return;\n        }\n        target.addEventListener('dragstart', this\n            .handleTopDragStart);\n        target.addEventListener('dragstart', this.handleTopDragStartCapture, true);\n        target.addEventListener('dragend', this.handleTopDragEndCapture, true);\n        target.addEventListener('dragenter', this\n            .handleTopDragEnter);\n        target.addEventListener('dragenter', this.handleTopDragEnterCapture, true);\n        target.addEventListener('dragleave', this.handleTopDragLeaveCapture, true);\n        target.addEventListener('dragover', this.handleTopDragOver);\n        target.addEventListener('dragover', this.handleTopDragOverCapture, true);\n        target.addEventListener('drop', this.handleTopDrop);\n        target.addEventListener('drop', this.handleTopDropCapture, true);\n    };\n    HTML5Backend.prototype.removeEventListeners = function (target) {\n        // SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n        if (!target.removeEventListener) {\n            return;\n        }\n        target.removeEventListener('dragstart', this.handleTopDragStart);\n        target.removeEventListener('dragstart', this.handleTopDragStartCapture, true);\n        target.removeEventListener('dragend', this.handleTopDragEndCapture, true);\n        target.removeEventListener('dragenter', this\n            .handleTopDragEnter);\n        target.removeEventListener('dragenter', this.handleTopDragEnterCapture, true);\n        target.removeEventListener('dragleave', this.handleTopDragLeaveCapture, true);\n        target.removeEventListener('dragover', this\n            .handleTopDragOver);\n        target.removeEventListener('dragover', this.handleTopDragOverCapture, true);\n        target.removeEventListener('drop', this.handleTopDrop);\n        target.removeEventListener('drop', this.handleTopDropCapture, true);\n    };\n    HTML5Backend.prototype.getCurrentSourceNodeOptions = function () {\n        var sourceId = this.monitor.getSourceId();\n        var sourceNodeOptions = this.sourceNodeOptions.get(sourceId);\n        return __assign({ dropEffect: this.altKeyPressed ? 'copy' : 'move' }, (sourceNodeOptions || {}));\n    };\n    HTML5Backend.prototype.getCurrentDropEffect = function () {\n        if (this.isDraggingNativeItem()) {\n            // It makes more sense to default to 'copy' for native resources\n            return 'copy';\n        }\n        return this.getCurrentSourceNodeOptions().dropEffect;\n    };\n    HTML5Backend.prototype.getCurrentSourcePreviewNodeOptions = function () {\n        var sourceId = this.monitor.getSourceId();\n        var sourcePreviewNodeOptions = this.sourcePreviewNodeOptions.get(sourceId);\n        return __assign({ anchorX: 0.5, anchorY: 0.5, captureDraggingState: false }, (sourcePreviewNodeOptions || {}));\n    };\n    HTML5Backend.prototype.isDraggingNativeItem = function () {\n        var itemType = this.monitor.getItemType();\n        return Object.keys(NativeTypes).some(function (key) { return NativeTypes[key] === itemType; });\n    };\n    HTML5Backend.prototype.beginDragNativeItem = function (type) {\n        this.clearCurrentDragSourceNode();\n        this.currentNativeSource = NativeDragSources_1.createNativeDragSource(type);\n        this.currentNativeHandle = this.registry.addSource(type, this.currentNativeSource);\n        this.actions.beginDrag([this.currentNativeHandle]);\n    };\n    HTML5Backend.prototype.setCurrentDragSourceNode = function (node) {\n        var _this = this;\n        this.clearCurrentDragSourceNode();\n        this.currentDragSourceNode = node;\n        // A timeout of > 0 is necessary to resolve Firefox issue referenced\n        // See:\n        //   * https://github.com/react-dnd/react-dnd/pull/928\n        //   * https://github.com/react-dnd/react-dnd/issues/869\n        var MOUSE_MOVE_TIMEOUT = 1000;\n        // Receiving a mouse event in the middle of a dragging operation\n        // means it has ended and the drag source node disappeared from DOM,\n        // so the browser didn't dispatch the dragend event.\n        //\n        // We need to wait before we start listening for mousemove events.\n        // This is needed because the drag preview needs to be drawn or else it fires an 'mousemove' event\n        // immediately in some browsers.\n        //\n        // See:\n        //   * https://github.com/react-dnd/react-dnd/pull/928\n        //   * https://github.com/react-dnd/react-dnd/issues/869\n        //\n        this.mouseMoveTimeoutTimer = setTimeout(function () {\n            return (_this.window &&\n                _this.window.addEventListener('mousemove', _this.endDragIfSourceWasRemovedFromDOM, true));\n        }, MOUSE_MOVE_TIMEOUT);\n    };\n    HTML5Backend.prototype.clearCurrentDragSourceNode = function () {\n        if (this.currentDragSourceNode) {\n            this.currentDragSourceNode = null;\n            if (this.window) {\n                this.window.clearTimeout(this.mouseMoveTimeoutTimer || undefined);\n                this.window.removeEventListener('mousemove', this.endDragIfSourceWasRemovedFromDOM, true);\n            }\n            this.mouseMoveTimeoutTimer = null;\n            return true;\n        }\n        return false;\n    };\n    HTML5Backend.prototype.handleDragStart = function (e, sourceId) {\n        if (!this.dragStartSourceIds) {\n            this.dragStartSourceIds = [];\n        }\n        this.dragStartSourceIds.unshift(sourceId);\n    };\n    HTML5Backend.prototype.handleDragEnter = function (e, targetId) {\n        this.dragEnterTargetIds.unshift(targetId);\n    };\n    HTML5Backend.prototype.handleDragOver = function (e, targetId) {\n        if (this.dragOverTargetIds === null) {\n            this.dragOverTargetIds = [];\n        }\n        this.dragOverTargetIds.unshift(targetId);\n    };\n    HTML5Backend.prototype.handleDrop = function (e, targetId) {\n        this.dropTargetIds.unshift(targetId);\n    };\n    return HTML5Backend;\n}());\nexports.default = HTML5Backend;\n"]},"metadata":{},"sourceType":"script"}